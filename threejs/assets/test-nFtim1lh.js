import{T as ae,V as o,E as re,b as se,S as ie,C as ce,P as de,O as le,H as we,D as me,G as he,B as ue,f as ge,g as pe,I as fe,h as ye,i as H,M as G,W as Me,L as P,k as L,l as E,X as be,m as ve,R as Ce,n as Le,o as Ee,a as Se}from"./STLLoader-CUGKHluW.js";import{C as q}from"./camera-controls.module-DKxc4fxB.js";q.install({THREE:ae});let b,m,d,r,p,f,y,S,j,v;const R=[];let g,h,A;const M=[];new o(-10,0,10),new o(-5,5,5),new o(5,5,5),new o(5,-5,5),new o(10,0,10),new o(-10,0,10),new o(-10,0,-20),new o(50,10,10);const je=new Se;new re(0,0,10,5);new o;const D=new se;xe();function xe(){var W;b=document.createElement("div"),document.body.appendChild(b),d=new ie,d.background=new ce("skyblue"),m=new de(50,window.innerWidth/window.innerHeight,.1,2e3),m.position.set(1,1,1),g=new le(m,b),g.target.set(0,1.6,0),g.update(),d.add(new we(12369084,10855845,3));const e=new me("0xffffff",3);e.position.set(0,6,0),e.castShadow=!0,e.shadow.camera.top=3,e.shadow.camera.bottom=-3,e.shadow.camera.right=3,e.shadow.camera.left=-3,e.shadow.mapSize.set(4096,4096),h=new he,d.add(h);const t=[new ue(.2,.2,.2),new ge(.2,.2,64),new pe(.2,.2,.2,64),new fe(.2,8),new ye(.2,.04,64,32)];for(let s=0;s<1;s++){const i=t[Math.floor(Math.random()*t.length)],c=new H({color:"red",roughness:.7,metalness:0}),n=new G(i,c);n.position.x=0,n.position.y=0,n.position.z=0,n.rotation.y=Math.PI/2,n.rotation.z=2*Math.PI,n.scale.setScalar(Math.random()+.5),n.castShadow=!0,n.receiveShadow=!0,h.add(n),M.push(n)}let a=new o;document.querySelectorAll(".nav-item").forEach(s=>{s.addEventListener("dragend",i=>{a.set(i.clientX/window.innerWidth*2-1,-(i.clientY/window.innerHeight)*2+1,.9),a.unproject(m);const c=s.getAttribute("data-type"),n=t[c],oe=new H({color:Math.random()*16777215,roughness:.7,metalness:0}),w=new G(n,oe);w.position.x=a.x,w.position.y=a.y,w.position.z=a.z,w.rotation.x=Math.random()*2*Math.PI,w.rotation.y=Math.random()*2*Math.PI,w.rotation.z=Math.random()*2*Math.PI,w.scale.setScalar(Math.random()+.5),w.castShadow=!0,w.receiveShadow=!0,h.add(w),M.push(w)})}),r=new Me({antialias:!0,preserveDrawingBuffer:!0}),r.setPixelRatio(window.devicePixelRatio),r.setSize(window.innerWidth,window.innerHeight),r.setAnimationLoop(x),r.shadowMap.enabled=!0,r.xr.enabled=!0,b.appendChild(r.domElement),A=new q(m,r.domElement),p=r.xr.getController(0),p.addEventListener("selectstart",I),p.addEventListener("selectend",O),d.add(p),f=r.xr.getController(1),f.addEventListener("selectstart",I),f.addEventListener("selectend",O),d.add(f);const l=[new o(0,0,0),new o(1e4,0,0)],u=new P({color:"red",linewidth:3}),T=new L().setFromPoints(l),U=new E(T,u);d.add(U);const V=[new o(0,0,0),new o(0,1e4,0)],Y=new P({color:"green",linewidth:3}),N=new L().setFromPoints(V),J=new E(N,Y);d.add(J);const K=[new o(0,0,0),new o(0,0,1e4)],Q=new P({color:"blue",linewidth:3}),Z=new L().setFromPoints(K),_=new E(Z,Q);d.add(_);const k=new be;S=r.xr.getControllerGrip(0),S.add(k.createControllerModel(S)),d.add(S),j=r.xr.getControllerGrip(1),j.add(k.createControllerModel(j)),d.add(j),y=new ve([...M],m,r.domElement),y.rotateSpeed=2,y.addEventListener("drag",x),y.addEventListener("dragstart",function(){g.enabled=!1}),y.addEventListener("dragend",function(){g.enabled=!0});const $=new L().setFromPoints([new o(0,0,0),new o(0,0,-1)]),C=new E($);C.name="line",C.scale.z=5,p.add(C.clone()),f.add(C.clone()),v=new Ce,window.addEventListener("resize",ze),document.addEventListener("click",Pe);const F=b.querySelector("canvas");F&&F.addEventListener("dragover",s=>{s.preventDefault()});const ee=new Le,z=document.querySelector("#file");z==null||z.addEventListener("change",s=>{ee.load(URL.createObjectURL(s.target.files[0]),i=>{const c=new Ee({color:Math.random()*16777215,specular:1118481,shininess:200}),n=new G(i,c);n.position.x=Math.random()*4-2,n.position.y=Math.random()*2,n.position.z=Math.random()*4-2,n.scale.setScalar(Math.random()+.5),n.castShadow=!0,n.receiveShadow=!0,i.center(),h.add(n),M.push(n)})});const te=()=>{let s;try{const i="image/jpeg",c="image/octet-stream";s=r.domElement.toDataURL(i),ne(s.replace(i,c),"snapshot.jpg")}catch(i){console.log(i);return}},ne=(s,i)=>{const c=document.createElement("a");typeof c.download=="string"?(document.body.appendChild(c),c.download=i,c.href=s,c.click(),document.body.removeChild(c)):location.replace(uri)};(W=document.querySelector("#snapshot button"))==null||W.addEventListener("click",te)}function ze(){m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight)}function I(e){const t=e.target,a=X(t);if(a.length>0){const u=a[0].object;u.material.emissive.b=1,t.attach(u),t.userData.selected=u}t.userData.targetRayMode=e.data.targetRayMode}function O(e){const t=e.target;if(t.userData.selected!==void 0){const a=t.userData.selected;a.material.emissive.b=0,h.attach(a),t.userData.selected=void 0}}function X(e){return e.updateMatrixWorld(),v.setFromXRController(e),v.intersectObjects(h.children,!1)}function B(e){if(e.userData.targetRayMode==="screen"||e.userData.selected!==void 0)return;const t=e.getObjectByName("line"),a=X(e);if(a.length>0){const l=a[0],u=l.object;u.material.emissive.r=1,R.push(u),t.scale.z=l.distance}else t.scale.z=5}function Ge(){for(;R.length;){const e=R.pop();e.material.emissive.r=0}}function Pe(e){if(!e.target.closest("canvas"))return;e.preventDefault();const t=y.getObjects();t.length=0,D.x=e.clientX/window.innerWidth*2-1,D.y=-(e.clientY/window.innerHeight)*2+1,v.setFromCamera(D,m);const a=v.intersectObjects(M,!0);if(a.length>0){const l=a[0].object;h.children.includes(l)===!0?(l.material.emissive.set(0),d.attach(l)):(l.material.emissive.set(11184810),h.attach(l)),g.transformGroup=!0,t.push(h)}h.children.length===0&&(g.transformGroup=!1,t.push(...M)),x()}function x(){Ge(),B(p),B(f);const e=je.getDelta(),t=A.update(e);requestAnimationFrame(x),t&&r.render(d,m),r.render(d,m)}
