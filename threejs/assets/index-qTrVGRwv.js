import{T as Ce,S as ae,C as he,P as le,O as ce,H as de,D as _e,G as me,W as pe,a as ue,V as v,B as we,E as ve,b as xe,c as De,d as Le,e as Ue,M as Kt,f as Se,g as Pe,h as Ae,I as ze,i as be,L as J,j as tt,k as lt,l as Fe,m as Me,n as Re,X as Ie,o as He,R as ke,p as Ye}from"./DragControls-ALxf4ldN.js";import{S as Ve}from"./STLLoader-DEcdGH4u.js";import{l as Tt}from"./micromodal.es-pqi34bRi.js";/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const b={LEFT:1,RIGHT:2,MIDDLE:4},i=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),et={NONE:0,IN:1,OUT:-1};function q(r){return r.isPerspectiveCamera}function G(r){return r.isOrthographicCamera}const st=Math.PI*2,Gt=Math.PI/2,fe=1e-5,ct=Math.PI/180;function Z(r,t,e){return Math.max(t,Math.min(e,r))}function S(r,t=fe){return Math.abs(r)<t}function L(r,t,e=fe){return S(r-t,e)}function qt(r,t){return Math.round(r/t)*t}function dt(r){return isFinite(r)?r:r<0?-Number.MAX_VALUE:Number.MAX_VALUE}function _t(r){return Math.abs(r)<Number.MAX_VALUE?r:r*(1/0)}function Ct(r,t,e,s,o=1/0,n){s=Math.max(1e-4,s);const h=2/s,l=h*n,c=1/(1+l+.48*l*l+.235*l*l*l);let d=r-t;const T=t,g=o*s;d=Z(d,-g,g),t=r-d;const w=(e.value+h*d)*n;e.value=(e.value-h*w)*c;let y=t+(d+w)*c;return T-r>0==y>T&&(y=T,e.value=(y-T)/n),y}function Wt(r,t,e,s,o=1/0,n,h){s=Math.max(1e-4,s);const l=2/s,c=l*n,d=1/(1+c+.48*c*c+.235*c*c*c);let T=t.x,g=t.y,w=t.z,y=r.x-T,P=r.y-g,C=r.z-w;const A=T,a=g,_=w,p=o*s,m=p*p,O=y*y+P*P+C*C;if(O>m){const D=Math.sqrt(O);y=y/D*p,P=P/D*p,C=C/D*p}T=r.x-y,g=r.y-P,w=r.z-C;const f=(e.x+l*y)*n,U=(e.y+l*P)*n,R=(e.z+l*C)*n;e.x=(e.x-l*f)*d,e.y=(e.y-l*U)*d,e.z=(e.z-l*R)*d,h.x=T+(y+f)*d,h.y=g+(P+U)*d,h.z=w+(C+R)*d;const $=A-r.x,K=a-r.y,Et=_-r.z,Ot=h.x-A,z=h.y-a,F=h.z-_;return $*Ot+K*z+Et*F>0&&(h.x=A,h.y=a,h.z=_,e.x=(h.x-A)/n,e.y=(h.y-a)/n,e.z=(h.z-_)/n),h}function bt(r,t){t.set(0,0),r.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=r.length,t.y/=r.length}function Ft(r,t){return G(r)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class Ze{constructor(){this._listeners={}}addEventListener(t,e){const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){const o=this._listeners[t];if(o!==void 0){const n=o.indexOf(e);n!==-1&&o.splice(n,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const s=this._listeners[t.type];if(s!==void 0){t.target=this;const o=s.slice(0);for(let n=0,h=o.length;n<h;n++)o[n].call(this,t)}}}var Mt;const Be="2.9.0",wt=1/8,Ne=/Mac/.test((Mt=globalThis==null?void 0:globalThis.navigator)===null||Mt===void 0?void 0:Mt.platform);let u,Qt,vt,Rt,H,E,x,it,mt,B,N,W,$t,Jt,Y,pt,ot,te,It,ee,Ht,kt,xt;class gt extends Ze{static install(t){u=t.THREE,Qt=Object.freeze(new u.Vector3(0,0,0)),vt=Object.freeze(new u.Vector3(0,1,0)),Rt=Object.freeze(new u.Vector3(0,0,1)),H=new u.Vector2,E=new u.Vector3,x=new u.Vector3,it=new u.Vector3,mt=new u.Vector3,B=new u.Vector3,N=new u.Vector3,W=new u.Vector3,$t=new u.Vector3,Jt=new u.Vector3,Y=new u.Spherical,pt=new u.Spherical,ot=new u.Box3,te=new u.Box3,It=new u.Sphere,ee=new u.Quaternion,Ht=new u.Quaternion,kt=new u.Matrix4,xt=new u.Raycaster}static get ACTION(){return i}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=i.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=et.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new u.Vector3,this._focalOffsetVelocity=new u.Vector3,this._zoomVelocity={value:0},this._truckInternal=(a,_,p)=>{let m,O;if(q(this._camera)){const f=E.copy(this._camera.position).sub(this._target),U=this._camera.getEffectiveFOV()*ct,R=f.length()*Math.tan(U*.5);m=this.truckSpeed*a*R/this._elementRect.height,O=this.truckSpeed*_*R/this._elementRect.height}else if(G(this._camera)){const f=this._camera;m=a*(f.right-f.left)/f.zoom/this._elementRect.width,O=_*(f.top-f.bottom)/f.zoom/this._elementRect.height}else return;this.verticalDragToForward?(p?this.setFocalOffset(this._focalOffsetEnd.x+m,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(m,0,!0),this.forward(-O,!0)):p?this.setFocalOffset(this._focalOffsetEnd.x+m,this._focalOffsetEnd.y+O,this._focalOffsetEnd.z,!0):this.truck(m,O,!0)},this._rotateInternal=(a,_)=>{const p=st*this.azimuthRotateSpeed*a/this._elementRect.height,m=st*this.polarRotateSpeed*_/this._elementRect.height;this.rotate(p,m,!0)},this._dollyInternal=(a,_,p)=>{const m=Math.pow(.95,-a*this.dollySpeed),O=this._sphericalEnd.radius,f=this._sphericalEnd.radius*m,U=Z(f,this.minDistance,this.maxDistance),R=U-f;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(f,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(R,!0),this._dollyToNoClamp(U,!0)):this._dollyToNoClamp(U,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?f:U)-O,this._dollyControlCoord.set(_,p)),this._lastDollyDirection=Math.sign(-a)},this._zoomInternal=(a,_,p)=>{const m=Math.pow(.95,a*this.dollySpeed),O=this._zoom,f=this._zoom*m;this.zoomTo(f,!0),this.dollyToCursor&&(this._changedZoom+=f-O,this._dollyControlCoord.set(_,p))},typeof u>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new u.Quaternion().setFromUnitVectors(this._camera.up,vt),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=i.NONE,this._target=new u.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new u.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new u.Spherical().setFromVector3(E.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new u.Vector3,new u.Vector3,new u.Vector3,new u.Vector3],this._updateNearPlaneCorners(),this._boundary=new u.Box3(new u.Vector3(-1/0,-1/0,-1/0),new u.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new u.Vector2,this.mouseButtons={left:i.ROTATE,middle:i.DOLLY,right:i.TRUCK,wheel:q(this._camera)?i.DOLLY:G(this._camera)?i.ZOOM:i.NONE},this.touches={one:i.TOUCH_ROTATE,two:q(this._camera)?i.TOUCH_DOLLY_TRUCK:G(this._camera)?i.TOUCH_ZOOM_TRUCK:i.NONE,three:i.TOUCH_TRUCK};const s=new u.Vector2,o=new u.Vector2,n=new u.Vector2,h=a=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const m=this._domElement.getBoundingClientRect(),O=a.clientX/m.width,f=a.clientY/m.height;if(O<this._interactiveArea.left||O>this._interactiveArea.right||f<this._interactiveArea.top||f>this._interactiveArea.bottom)return}const _=a.pointerType!=="mouse"?null:(a.buttons&b.LEFT)===b.LEFT?b.LEFT:(a.buttons&b.MIDDLE)===b.MIDDLE?b.MIDDLE:(a.buttons&b.RIGHT)===b.RIGHT?b.RIGHT:null;if(_!==null){const m=this._findPointerByMouseButton(_);m&&this._disposePointer(m)}if((a.buttons&b.LEFT)===b.LEFT&&this._lockedPointer)return;const p={pointerId:a.pointerId,clientX:a.clientX,clientY:a.clientY,deltaX:0,deltaY:0,mouseButton:_};this._activePointers.push(p),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,w(a)},l=a=>{a.cancelable&&a.preventDefault();const _=a.pointerId,p=this._lockedPointer||this._findPointerById(_);if(p){if(p.clientX=a.clientX,p.clientY=a.clientY,p.deltaX=a.movementX,p.deltaY=a.movementY,this._state=0,a.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(a.buttons&b.LEFT)===b.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(a.buttons&b.MIDDLE)===b.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(a.buttons&b.RIGHT)===b.RIGHT&&(this._state=this._state|this.mouseButtons.right);y()}},c=a=>{const _=this._findPointerById(a.pointerId);if(!(_&&_===this._lockedPointer)){if(_&&this._disposePointer(_),a.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=i.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=i.NONE;P()}};let d=-1;const T=a=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===i.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const f=this._domElement.getBoundingClientRect(),U=a.clientX/f.width,R=a.clientY/f.height;if(U<this._interactiveArea.left||U>this._interactiveArea.right||R<this._interactiveArea.top||R>this._interactiveArea.bottom)return}if(a.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===i.ROTATE||this.mouseButtons.wheel===i.TRUCK){const f=performance.now();d-f<1e3&&this._getClientRect(this._elementRect),d=f}const _=Ne?-1:-3,p=a.deltaMode===1?a.deltaY/_:a.deltaY/(_*10),m=this.dollyToCursor?(a.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,O=this.dollyToCursor?(a.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case i.ROTATE:{this._rotateInternal(a.deltaX,a.deltaY),this._isUserControllingRotate=!0;break}case i.TRUCK:{this._truckInternal(a.deltaX,a.deltaY,!1),this._isUserControllingTruck=!0;break}case i.OFFSET:{this._truckInternal(a.deltaX,a.deltaY,!0),this._isUserControllingOffset=!0;break}case i.DOLLY:{this._dollyInternal(-p,m,O),this._isUserControllingDolly=!0;break}case i.ZOOM:{this._zoomInternal(-p,m,O),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},g=a=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===gt.ACTION.NONE){const _=a instanceof PointerEvent?a.pointerId:0,p=this._findPointerById(_);p&&this._disposePointer(p),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c);return}a.preventDefault()}},w=a=>{if(!this._enabled)return;if(bt(this._activePointers,H),this._getClientRect(this._elementRect),s.copy(H),o.copy(H),this._activePointers.length>=2){const p=H.x-this._activePointers[1].clientX,m=H.y-this._activePointers[1].clientY,O=Math.sqrt(p*p+m*m);n.set(0,O);const f=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,U=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;o.set(f,U)}if(this._state=0,!a)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in a&&a.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(a.buttons&b.LEFT)===b.LEFT&&(this._state=this._state|this.mouseButtons.left),(a.buttons&b.MIDDLE)===b.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(a.buttons&b.RIGHT)===b.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&i.ROTATE)===i.ROTATE||(this._state&i.TOUCH_ROTATE)===i.TOUCH_ROTATE||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&i.TRUCK)===i.TRUCK||(this._state&i.TOUCH_TRUCK)===i.TOUCH_TRUCK||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&i.DOLLY)===i.DOLLY||(this._state&i.TOUCH_DOLLY)===i.TOUCH_DOLLY||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&i.ZOOM)===i.ZOOM||(this._state&i.TOUCH_ZOOM)===i.TOUCH_ZOOM||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&i.OFFSET)===i.OFFSET||(this._state&i.TOUCH_OFFSET)===i.TOUCH_OFFSET||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},y=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,bt(this._activePointers,H);const _=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,p=_?-_.deltaX:o.x-H.x,m=_?-_.deltaY:o.y-H.y;if(o.copy(H),((this._state&i.ROTATE)===i.ROTATE||(this._state&i.TOUCH_ROTATE)===i.TOUCH_ROTATE||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(p,m),this._isUserControllingRotate=!0),(this._state&i.DOLLY)===i.DOLLY||(this._state&i.ZOOM)===i.ZOOM){const O=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,f=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,U=this.dollyDragInverted?-1:1;(this._state&i.DOLLY)===i.DOLLY?(this._dollyInternal(U*m*wt,O,f),this._isUserControllingDolly=!0):(this._zoomInternal(U*m*wt,O,f),this._isUserControllingZoom=!0)}if((this._state&i.TOUCH_DOLLY)===i.TOUCH_DOLLY||(this._state&i.TOUCH_ZOOM)===i.TOUCH_ZOOM||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE){const O=H.x-this._activePointers[1].clientX,f=H.y-this._activePointers[1].clientY,U=Math.sqrt(O*O+f*f),R=n.y-U;n.set(0,U);const $=this.dollyToCursor?(o.x-this._elementRect.x)/this._elementRect.width*2-1:0,K=this.dollyToCursor?(o.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&i.TOUCH_DOLLY)===i.TOUCH_DOLLY||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET?(this._dollyInternal(R*wt,$,K),this._isUserControllingDolly=!0):(this._zoomInternal(R*wt,$,K),this._isUserControllingZoom=!0)}((this._state&i.TRUCK)===i.TRUCK||(this._state&i.TOUCH_TRUCK)===i.TOUCH_TRUCK||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(p,m,!1),this._isUserControllingTruck=!0),((this._state&i.OFFSET)===i.OFFSET||(this._state&i.TOUCH_OFFSET)===i.TOUCH_OFFSET||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(p,m,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},P=()=>{bt(this._activePointers,H),o.copy(H),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",C),this._domElement.ownerDocument.addEventListener("pointerlockerror",A),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),w())},this.unlockPointer=()=>{var a,_,p;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(a=this._domElement)===null||a===void 0||a.ownerDocument.exitPointerLock(),(_=this._domElement)===null||_===void 0||_.ownerDocument.removeEventListener("pointerlockchange",C),(p=this._domElement)===null||p===void 0||p.ownerDocument.removeEventListener("pointerlockerror",A),this.cancel()};const C=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},A=()=>{this.unlockPointer()};this._addAllEventListeners=a=>{this._domElement=a,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",h),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",T,{passive:!1}),this._domElement.addEventListener("contextmenu",g)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",h),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",T,{passive:!1}),this._domElement.removeEventListener("contextmenu",g),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("pointerlockchange",C),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))},this.cancel=()=>{this._state!==i.NONE&&(this._state=i.NONE,this._activePointers.length=0,P())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=Z(t.width,0,1),this._interactiveArea.height=Z(t.height,0,1),this._interactiveArea.x=Z(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Z(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,s=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,s)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,s=!1){this._isUserControllingRotate=!1;const o=Z(t,this.minAzimuthAngle,this.maxAzimuthAngle),n=Z(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=o,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const h=!s||L(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&L(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(h)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=et.NONE,this._changedDolly=0,this._dollyToNoClamp(Z(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const h=this._collisionTest(),l=L(h,this._spherical.radius);if(!(s>t)&&l)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,h)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const n=!e||L(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(mt).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const s=!e||L(this._target.x,this._targetEnd.x,this.restThreshold)&&L(this._target.y,this._targetEnd.y,this.restThreshold)&&L(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=Z(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const s=!e||L(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(t,e,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,s)}truck(t,e,s=!1){this._camera.updateMatrix(),B.setFromMatrixColumn(this._camera.matrix,0),N.setFromMatrixColumn(this._camera.matrix,1),B.multiplyScalar(t),N.multiplyScalar(-e);const o=E.copy(B).add(N),n=x.copy(this._targetEnd).add(o);return this.moveTo(n.x,n.y,n.z,s)}forward(t,e=!1){E.setFromMatrixColumn(this._camera.matrix,0),E.crossVectors(this._camera.up,E),E.multiplyScalar(t);const s=x.copy(this._targetEnd).add(E);return this.moveTo(s.x,s.y,s.z,e)}elevate(t,e=!1){return E.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+E.x,this._targetEnd.y+E.y,this._targetEnd.z+E.z,e)}moveTo(t,e,s,o=!1){this._isUserControllingTruck=!1;const n=E.set(t,e,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,o||this._target.copy(this._targetEnd);const h=!o||L(this._target.x,this._targetEnd.x,this.restThreshold)&&L(this._target.y,this._targetEnd.y,this.restThreshold)&&L(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(h)}lookInDirectionOf(t,e,s,o=!1){const l=E.set(t,e,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(l.x,l.y,l.z,o)}fitToBox(t,e,{cover:s=!1,paddingLeft:o=0,paddingRight:n=0,paddingBottom:h=0,paddingTop:l=0}={}){const c=[],d=t.isBox3?ot.copy(t):ot.setFromObject(t);d.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const T=qt(this._sphericalEnd.theta,Gt),g=qt(this._sphericalEnd.phi,Gt);c.push(this.rotateTo(T,g,e));const w=E.setFromSpherical(this._sphericalEnd).normalize(),y=ee.setFromUnitVectors(w,Rt),P=L(Math.abs(w.y),1);P&&y.multiply(Ht.setFromAxisAngle(vt,T)),y.multiply(this._yAxisUpSpaceInverse);const C=te.makeEmpty();x.copy(d.min).applyQuaternion(y),C.expandByPoint(x),x.copy(d.min).setX(d.max.x).applyQuaternion(y),C.expandByPoint(x),x.copy(d.min).setY(d.max.y).applyQuaternion(y),C.expandByPoint(x),x.copy(d.max).setZ(d.min.z).applyQuaternion(y),C.expandByPoint(x),x.copy(d.min).setZ(d.max.z).applyQuaternion(y),C.expandByPoint(x),x.copy(d.max).setY(d.min.y).applyQuaternion(y),C.expandByPoint(x),x.copy(d.max).setX(d.min.x).applyQuaternion(y),C.expandByPoint(x),x.copy(d.max).applyQuaternion(y),C.expandByPoint(x),C.min.x-=o,C.min.y-=h,C.max.x+=n,C.max.y+=l,y.setFromUnitVectors(Rt,w),P&&y.premultiply(Ht.invert()),y.premultiply(this._yAxisUpSpace);const A=C.getSize(E),a=C.getCenter(x).applyQuaternion(y);if(q(this._camera)){const _=this.getDistanceToFitBox(A.x,A.y,A.z,s);c.push(this.moveTo(a.x,a.y,a.z,e)),c.push(this.dollyTo(_,e)),c.push(this.setFocalOffset(0,0,0,e))}else if(G(this._camera)){const _=this._camera,p=_.right-_.left,m=_.top-_.bottom,O=s?Math.max(p/A.x,m/A.y):Math.min(p/A.x,m/A.y);c.push(this.moveTo(a.x,a.y,a.z,e)),c.push(this.zoomTo(O,e)),c.push(this.setFocalOffset(0,0,0,e))}return Promise.all(c)}fitToSphere(t,e){const s=[],n="isObject3D"in t?gt.createBoundingSphere(t,It):It.copy(t);if(s.push(this.moveTo(n.center.x,n.center.y,n.center.z,e)),q(this._camera)){const h=this.getDistanceToFitSphere(n.radius);s.push(this.dollyTo(h,e))}else if(G(this._camera)){const h=this._camera.right-this._camera.left,l=this._camera.top-this._camera.bottom,c=2*n.radius,d=Math.min(h/c,l/c);s.push(this.zoomTo(d,e))}return s.push(this.setFocalOffset(0,0,0,e)),Promise.all(s)}setLookAt(t,e,s,o,n,h,l=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=et.NONE,this._changedDolly=0;const c=x.set(o,n,h),d=E.set(t,e,s);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(d.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,l||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const T=!l||L(this._target.x,this._targetEnd.x,this.restThreshold)&&L(this._target.y,this._targetEnd.y,this.restThreshold)&&L(this._target.z,this._targetEnd.z,this.restThreshold)&&L(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&L(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&L(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(T)}lerpLookAt(t,e,s,o,n,h,l,c,d,T,g,w,y,P=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=et.NONE,this._changedDolly=0;const C=E.set(o,n,h),A=x.set(t,e,s);Y.setFromVector3(A.sub(C).applyQuaternion(this._yAxisUpSpace));const a=it.set(T,g,w),_=x.set(l,c,d);pt.setFromVector3(_.sub(a).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(C.lerp(a,y));const p=pt.theta-Y.theta,m=pt.phi-Y.phi,O=pt.radius-Y.radius;this._sphericalEnd.set(Y.radius+O*y,Y.phi+m*y,Y.theta+p*y),this.normalizeRotations(),this._needsUpdate=!0,P||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const f=!P||L(this._target.x,this._targetEnd.x,this.restThreshold)&&L(this._target.y,this._targetEnd.y,this.restThreshold)&&L(this._target.z,this._targetEnd.z,this.restThreshold)&&L(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&L(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&L(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(f)}setPosition(t,e,s,o=!1){return this.setLookAt(t,e,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,o)}setTarget(t,e,s,o=!1){const n=this.getPosition(E),h=this.setLookAt(n.x,n.y,n.z,t,e,s,o);return this._sphericalEnd.phi=Z(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),h}setFocalOffset(t,e,s,o=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,s),this._needsUpdate=!0,o||this._focalOffset.copy(this._focalOffsetEnd);const n=!o||L(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&L(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&L(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(t,e,s){this._camera.updateMatrixWorld(),B.setFromMatrixColumn(this._camera.matrixWorldInverse,0),N.setFromMatrixColumn(this._camera.matrixWorldInverse,1),W.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const o=E.set(t,e,s),n=o.distanceTo(this._camera.position),h=o.sub(this._camera.position);B.multiplyScalar(h.x),N.multiplyScalar(h.y),W.multiplyScalar(h.z),E.copy(B).add(N).add(W),E.z=E.z+n,this.dollyTo(n,!1),this.setFocalOffset(-E.x,E.y,-E.z,!1),this.moveTo(t,e,s,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,s,o){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new u.Vector4,typeof t=="number"?this._viewport.set(t,e,s,o):this._viewport.copy(t)}getDistanceToFitBox(t,e,s,o=!1){if(Ft(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=t/e,h=this._camera.getEffectiveFOV()*ct,l=this._camera.aspect;return((o?n>l:n<l)?e:t/l)*.5/Math.tan(h*.5)+s*.5}getDistanceToFitSphere(t){if(Ft(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*ct,s=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,o=1<this._camera.aspect?e:s;return t/Math.sin(o*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new u.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new u.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new u.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new u.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%st,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=st),this._spherical.theta+=st*Math.round((this._sphericalEnd.theta-this._spherical.theta)/st)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!L(this._camera.up.x,this._cameraUp0.x)||!L(this._camera.up.y,this._cameraUp0.y)||!L(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(E);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,vt),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=E.subVectors(this._target,this._camera.position).normalize(),e=x.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(E);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,o=this._sphericalEnd.radius-this._spherical.radius,n=$t.subVectors(this._targetEnd,this._target),h=Jt.subVectors(this._focalOffsetEnd,this._focalOffset),l=this._zoomEnd-this._zoom;if(S(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const g=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Ct(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,g,1/0,t),this._needsUpdate=!0}if(S(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const g=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Ct(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,g,1/0,t),this._needsUpdate=!0}if(S(o))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const g=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Ct(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,g,this.maxSpeed,t),this._needsUpdate=!0}if(S(n.x)&&S(n.y)&&S(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const g=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Wt(this._target,this._targetEnd,this._targetVelocity,g,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(S(h.x)&&S(h.y)&&S(h.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const g=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Wt(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,g,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(S(l))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const g=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Ct(this._zoom,this._zoomEnd,this._zoomVelocity,g,1/0,t)}if(this.dollyToCursor){if(q(this._camera)&&this._changedDolly!==0){const g=this._spherical.radius-this._lastDistance,w=this._camera,y=this._getCameraDirection(mt),P=E.copy(y).cross(w.up).normalize();P.lengthSq()===0&&(P.x=1);const C=x.crossVectors(P,y),A=this._sphericalEnd.radius*Math.tan(w.getEffectiveFOV()*ct*.5),_=(this._sphericalEnd.radius-g-this._sphericalEnd.radius)/this._sphericalEnd.radius,p=it.copy(this._targetEnd).add(P.multiplyScalar(this._dollyControlCoord.x*A*w.aspect)).add(C.multiplyScalar(this._dollyControlCoord.y*A)),m=E.copy(this._targetEnd).lerp(p,_),O=this._lastDollyDirection===et.IN&&this._spherical.radius<=this.minDistance,f=this._lastDollyDirection===et.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(O||f)){this._sphericalEnd.radius-=g,this._spherical.radius-=g;const R=x.copy(y).multiplyScalar(-g);m.add(R)}this._boundary.clampPoint(m,m);const U=x.subVectors(m,this._targetEnd);this._targetEnd.copy(m),this._target.add(U),this._changedDolly-=g,S(this._changedDolly)&&(this._changedDolly=0)}else if(G(this._camera)&&this._changedZoom!==0){const g=this._zoom-this._lastZoom,w=this._camera,y=E.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(w.near+w.far)/(w.near-w.far)).unproject(w),P=x.set(0,0,-1).applyQuaternion(w.quaternion),C=it.copy(y).add(P.multiplyScalar(-y.dot(w.up))),a=-(this._zoom-g-this._zoom)/this._zoom,_=this._getCameraDirection(mt),p=this._targetEnd.dot(_),m=E.copy(this._targetEnd).lerp(C,a),O=m.dot(_),f=_.multiplyScalar(O-p);m.sub(f),this._boundary.clampPoint(m,m);const U=x.subVectors(m,this._targetEnd);this._targetEnd.copy(m),this._target.add(U),this._changedZoom-=g,S(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!S(this._focalOffset.x)||!S(this._focalOffset.y)||!S(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),B.setFromMatrixColumn(this._camera.matrix,0),N.setFromMatrixColumn(this._camera.matrix,1),W.setFromMatrixColumn(this._camera.matrix,2),B.multiplyScalar(this._focalOffset.x),N.multiplyScalar(-this._focalOffset.y),W.multiplyScalar(this._focalOffset.z),E.copy(B).add(N).add(W),this._camera.position.add(E)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),E.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const T=this._needsUpdate;return T&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):T?(this.dispatchEvent({type:"update"}),S(e,this.restThreshold)&&S(s,this.restThreshold)&&S(o,this.restThreshold)&&S(n.x,this.restThreshold)&&S(n.y,this.restThreshold)&&S(n.z,this.restThreshold)&&S(h.x,this.restThreshold)&&S(h.y,this.restThreshold)&&S(h.z,this.restThreshold)&&S(l,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!T&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=T,this._needsUpdate=!1,T}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:dt(this.maxDistance),minZoom:this.minZoom,maxZoom:dt(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:dt(this.maxPolarAngle),minAzimuthAngle:dt(this.minAzimuthAngle),maxAzimuthAngle:dt(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:E.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const s=JSON.parse(t);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=_t(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=_t(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=_t(s.maxPolarAngle),this.minAzimuthAngle=_t(s.minAzimuthAngle),this.maxAzimuthAngle=_t(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],e),Y.setFromVector3(E.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Y.theta,Y.phi,e),this.dollyTo(Y.radius,e),this.zoomTo(s.zoom,e),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",Be),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,s){const o=e.lengthSq();if(o===0)return t;const n=x.copy(e).add(t),l=this._boundary.clampPoint(n,it).sub(n),c=l.lengthSq();if(c===0)return t.add(e);if(c===o)return t;if(s===0)return t.add(e).add(l);{const d=1+s*c/e.dot(l);return t.add(x.copy(e).multiplyScalar(d)).add(l.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(q(this._camera)){const t=this._camera,e=t.near,s=t.getEffectiveFOV()*ct,o=Math.tan(s*.5)*e,n=o*t.aspect;this._nearPlaneCorners[0].set(-n,-o,0),this._nearPlaneCorners[1].set(n,-o,0),this._nearPlaneCorners[2].set(n,o,0),this._nearPlaneCorners[3].set(-n,o,0)}else if(G(this._camera)){const t=this._camera,e=1/t.zoom,s=t.left*e,o=t.right*e,n=t.top*e,h=t.bottom*e;this._nearPlaneCorners[0].set(s,n,0),this._nearPlaneCorners[1].set(o,n,0),this._nearPlaneCorners[2].set(o,h,0),this._nearPlaneCorners[3].set(s,h,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||Ft(this._camera,"_collisionTest"))return t;const s=this._getTargetDirection(mt);kt.lookAt(Qt,s,this._camera.up);for(let o=0;o<4;o++){const n=x.copy(this._nearPlaneCorners[o]);n.applyMatrix4(kt);const h=it.addVectors(this._target,n);xt.set(h,s),xt.far=this._spherical.radius+1;const l=xt.intersectObjects(this.colliderMeshes);l.length!==0&&l[0].distance<t&&(t=l[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const s=()=>{this.removeEventListener("rest",s),e()};this.addEventListener("rest",s)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new u.Sphere){const s=e,o=s.center;ot.makeEmpty(),t.traverseVisible(h=>{h.isMesh&&ot.expandByObject(h)}),ot.getCenter(o);let n=0;return t.traverseVisible(h=>{if(!h.isMesh)return;const l=h,c=l.geometry.clone();c.applyMatrix4(l.matrixWorld);const T=c.attributes.position;for(let g=0,w=T.count;g<w;g++)E.fromBufferAttribute(T,g),n=Math.max(n,o.distanceToSquared(E))}),s.radius=Math.sqrt(n),s}}gt.install({THREE:Ce});const je=r=>{const t=document.createElement("div");t.style.width="100vw",t.style.height="100vh";const e=new ue,s=new ae;s.background=new he("skyblue");const o=new le(50,window.innerWidth/window.innerHeight,.1,2e3);o.position.set(1,1,1);const n=new ce(o,t);n.target.set(0,1.6,0),n.update(),s.add(new de(12369084,10855845,3));const h=new _e("0xffffff",3);h.position.set(0,6,0),h.castShadow=!0,h.shadow.camera.top=3,h.shadow.camera.bottom=-3,h.shadow.camera.right=3,h.shadow.camera.left=-3,h.shadow.mapSize.set(4096,4096),s.add(h);const l=new me,c=r.clone();c.position.set(0,0,0),l.add(c),s.add(l);const d=new pe({antialias:!0,preserveDrawingBuffer:!0});d.setPixelRatio(window.devicePixelRatio),d.setSize(window.innerWidth,window.innerHeight),d.shadowMap.enabled=!0,d.xr.enabled=!0,t.appendChild(d.domElement);const T=new gt(o,d.domElement);T.fitToBox(l),T.zoomTo(1);const g=e.getDelta();T.update(g),d.render(s,o);const w=d.domElement.toDataURL("image/jpeg");return t.remove(),d.dispose(),n.dispose(),T.dispose(),w},Dt=new v,se=new v,Lt=new we;function ge(r,t,e,s){Lt.makeEmpty(),Lt.expandByObject(r),Lt.getSize(Dt),Lt.getCenter(se);const o=s?.5:4,h=Math.max(Dt.x,Dt.y,Dt.z)/(2*Math.atan(Math.PI*t.fov/360)),l=h/t.aspect,c=o*Math.max(h,l),d=e.target.clone().sub(t.position).normalize().multiplyScalar(c);e.maxDistance=c*10,e.target.copy(se),t.near=c/100,t.far=c*100,t.updateProjectionMatrix(),t.position.copy(e.target).sub(d),e.update()}function Xe(r,t,e){const s=new v;r.getWorldPosition(s);const o=new v;r.getWorldDirection(o);const n=e?-.5:-3,h=s.clone().add(o.clone().multiplyScalar(n));t.position.copy(h),t.rotation.copy(r.rotation),t.lookAt(s)}let ut,V,M,I,nt,rt,at,Ut,St,yt;const Nt=[];let j,X;const k=[],Pt=[],ye=[];let ht=null,Yt=0,ft=new v,Vt;const Ke=[[new v(-10,0,10),new v(-5,5,5),new v(5,5,5),new v(5,-5,5),new v(10,0,10),new v(-10,0,10)],[new v(-10,0,-20),new v(50,10,10)],[new v(50,30,60),new v(20,10,55),new v(10,20,5),new v(20,10,35),new v(50,30,60)],[new v(-40,20,-20),new v(-20,10,25),new v(-10,20,5),new v(-40,20,-20)]],Ge=new ue,At=new ve(0,0,10,5);let ie;const Zt=new v,jt=[],Bt=new xe;let Q="fixed";qe();function qe(){var Ot;Tt.init(),ut=document.createElement("div"),document.body.appendChild(ut),M=new ae,M.background=new he("skyblue"),V=new le(50,window.innerWidth/window.innerHeight,.1,2e3),V.position.set(10,10,10),j=new ce(V,ut),j.target.set(0,1.6,0),j.update();const r=new De(6,6),t=new Le({opacity:.25,blending:Ue,transparent:!1}),e=new Kt(r,t);e.rotation.x=-Math.PI/2,e.receiveShadow=!0,M.add(e),M.add(new de(12369084,10855845,3));const s=new _e("0xffffff",3);s.position.set(0,6,0),s.castShadow=!0,s.shadow.camera.top=3,s.shadow.camera.bottom=-3,s.shadow.camera.right=3,s.shadow.camera.left=-3,s.shadow.mapSize.set(4096,4096),M.add(s),X=new me,M.add(X);const o=[new Se(.2,.2,.2),new Pe(.2,.2,64),new Ae(.2,.2,.2,64),new ze(.2,8),new be(.2,.04,64,32)];ie=new J(new tt().setFromPoints(At.getSpacedPoints(100)),new lt({color:"black"})),M.add(ie),jt.push(At),Ke.map(z=>{const F=new Fe(z),D=new tt().setFromPoints(F.getPoints(50)),zt=new lt({color:0}),Te=new J(D,zt);M.add(Te),jt.push(F)}),document.querySelectorAll(".nav-item").forEach(z=>{z.addEventListener("dragend",F=>{ft.set(F.clientX/window.innerWidth*2-1,-(F.clientY/window.innerHeight)*2+1,.9),ft.unproject(V);const D=z.getAttribute("data-type");Vt=o[D],Tt.show("modal-1")})}),document.querySelectorAll(".js-add-obj").forEach(z=>{z.addEventListener("click",()=>{const F=new Me({color:Math.random()*16777215,roughness:.7,metalness:0}),D=new Kt(Vt,F);D.position.x=ft.x,D.position.y=ft.y,D.position.z=ft.z,D.rotation.x=Math.random()*2*Math.PI,D.rotation.y=Math.random()*2*Math.PI,D.rotation.z=Math.random()*2*Math.PI,D.scale.setScalar(Math.random()+.5),D.castShadow=!0,D.receiveShadow=!0,X.add(D),k.push(D),z.classList.contains("js-add-path")&&ye.push({objIndex:k.length-1,pathIndex:Yt,speed:document.querySelector(".js-speed").value||10}),Tt.close("modal-1")})}),Oe(),I=new pe({antialias:!0,preserveDrawingBuffer:!0}),I.setPixelRatio(window.devicePixelRatio),I.setSize(window.innerWidth,window.innerHeight),I.setAnimationLoop(Xt),I.shadowMap.enabled=!0,I.transparent=!0,I.alpha=!0,I.xr.enabled=!0,ut.appendChild(I.domElement),nt=I.xr.getController(0),nt.addEventListener("selectstart",oe),nt.addEventListener("selectend",ne),M.add(nt),rt=I.xr.getController(1),rt.addEventListener("selectstart",oe),rt.addEventListener("selectend",ne),M.add(rt);const n=[new v(0,0,0),new v(1e4,0,0)],h=new lt({color:"red",linewidth:3}),l=new tt().setFromPoints(n),c=new J(l,h);M.add(c);const d=[new v(0,0,0),new v(0,1e4,0)],T=new lt({color:"green",linewidth:3}),g=new tt().setFromPoints(d),w=new J(g,T);M.add(w);const y=[new v(0,0,0),new v(0,0,1e4)],P=new lt({color:"blue",linewidth:3}),C=new tt().setFromPoints(y),A=new J(C,P);M.add(A);const a=new Re(100,100);M.add(a);const _=new Ie;Ut=I.xr.getControllerGrip(0),Ut.add(_.createControllerModel(Ut)),M.add(Ut),St=I.xr.getControllerGrip(1),St.add(_.createControllerModel(St)),M.add(St),at=new He([...k],V,I.domElement),at.rotateSpeed=2,at.addEventListener("drag",Xt),at.addEventListener("dragstart",function(){j.enabled=!1}),at.addEventListener("dragend",function(){j.enabled=!0});const p=new tt().setFromPoints([new v(0,0,0),new v(0,0,-1)]),m=new J(p);m.name="line",m.scale.z=5,nt.add(m.clone()),rt.add(m.clone()),yt=new ke,window.addEventListener("resize",We),document.addEventListener("click",$e);const O=ut.querySelector("canvas");O&&O.addEventListener("dragover",z=>{z.preventDefault()});const f=new Ve,U=document.querySelector("#file");U==null||U.addEventListener("change",z=>{f.load(URL.createObjectURL(z.target.files[0]),F=>{new Ye({color:Math.random()*16777215,specular:1118481,shininess:200}),Vt=F,Tt.show("modal-1")})});const R=()=>{let z;try{const F="image/jpeg",D="image/octet-stream";z=I.domElement.toDataURL(F),$(z.replace(F,D),"snapshot.jpg")}catch(F){console.log(F);return}},$=(z,F)=>{const D=document.createElement("a");typeof D.download=="string"?(document.body.appendChild(D),D.download=F,D.href=z,D.click(),document.body.removeChild(D)):location.replace(uri)};(Ot=document.querySelector("#snapshot button"))==null||Ot.addEventListener("click",R);const K=document.querySelector("#object-view-mode-select");K==null||K.addEventListener("change",z=>{Q=z.target.value});const Et=document.querySelector(".js-path-list");if(Et){const z=Et.querySelectorAll(".path-item");z.forEach((F,D)=>{F.addEventListener("click",()=>{Yt!==D&&(Yt=D,z.forEach(zt=>{zt.classList.remove("selected")}),F.classList.add("selected"))})})}}function We(){V.aspect=window.innerWidth/window.innerHeight,V.updateProjectionMatrix(),I.setSize(window.innerWidth,window.innerHeight)}function oe(r){const t=r.target,e=Ee(t);if(e.length>0){const o=e[0].object;o.material.emissive.b=1,t.attach(o),t.userData.selected=o}t.userData.targetRayMode=r.data.targetRayMode}function ne(r){const t=r.target;if(t.userData.selected!==void 0){const e=t.userData.selected;e.material.emissive.b=0,X.attach(e),t.userData.selected=void 0}}function Ee(r){return r.updateMatrixWorld(),yt.setFromXRController(r),yt.intersectObjects(X.children,!1)}function re(r){if(r.userData.targetRayMode==="screen"||r.userData.selected!==void 0)return;const t=r.getObjectByName("line"),e=Ee(r);if(e.length>0){const s=e[0],o=s.object;o.material.emissive.r=1,Nt.push(o),t.scale.z=s.distance}else t.scale.z=5}function Qe(){for(;Nt.length;){const r=Nt.pop();r.material.emissive.r=0}}function $e(r){if(!r.target.closest("canvas"))return;r.preventDefault();const t=at.getObjects();t.length=0,Bt.x=r.clientX/window.innerWidth*2-1,Bt.y=-(r.clientY/window.innerHeight)*2+1,yt.setFromCamera(Bt,V);const e=yt.intersectObjects(k,!0);if(e.length>0){const s=e[0].object;X.children.includes(s)===!0?(s.material.emissive.set(0),M.attach(s)):(s.material.emissive.set(11184810),X.attach(s)),j.transformGroup=!0,t.push(X)}X.children.length===0&&(j.transformGroup=!1,t.push(...k)),Xt()}function Je(){ye.forEach(r=>{const t=r.objIndex,e=k[t],s=r.pathIndex,o=jt[s];if(e&&o)if(s>0){const n=o.getPoints(50).length,l=(Date.now()+t*1e3)/(201-r.speed)%n/n,c=o.getPointAt(l);e.position.copy(c);const d=o.getTangentAt(l).normalize();e.lookAt(c.clone().add(d))}else{let n=Ge.getElapsedTime()*(parseFloat(r.speed)/200)%1;const h=n+t*.05>1?1:n+t*.05;At.getPointAt(h,Zt),e.position.copy(Zt);const l=At.getTangentAt(n).normalize(),c=new v(l.x,l.y,0);e.lookAt(Zt.clone().add(new v().copy(c)))}})}function Oe(){const r=document.querySelector("#object-list .object-item-container"),t=e=>{console.log("Follow id: ",e);const s=k[e];r==null||r.querySelectorAll(".object-item").forEach(o=>{o.classList.remove("active")}),ht===e?ht=null:(r.querySelector(`.object-item[data-id="${e}"]`).classList.add("active"),ht=e,ge(s,V,j))};for(let e=0;e<k.length;e++){let s=Pt==null?void 0:Pt[e];const o=k[e];if(!s){const h=je(k[e]);Pt.push(h);const l=document.createElement("div");l.classList.add("object-item"),l.dataset.id=e,l.innerHTML=`
        <img src="${h}" alt="object snapshot" />
        <div class="object-info">
        </div>
      `,l.addEventListener("click",()=>t(e)),r.appendChild(l)}const n=r.querySelector(`.object-item[data-id="${e}"] .object-info`);n&&(n.innerHTML=`(${o.position.x.toFixed(2)}, ${o.position.y.toFixed(2)}, ${o.position.z.toFixed(2)})`)}}function Xt(){if(Qe(),re(nt),re(rt),Je(),Oe(),ht!==null){const r=k[ht],t=Q==null?void 0:Q.includes("first");r.visible=!t,Q!=null&&Q.includes("fixed")?Xe(r,V,t):ge(r,V,j,t)}for(let r=0;r<k.length;r++)ht!==r&&(k[r].visible=!0);I.render(M,V)}
