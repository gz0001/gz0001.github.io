import{V as r,E as N,b as Y,S as J,C as K,P as Q,O as Z,c as _,d as $,e as ee,M as D,H as te,D as ne,G as oe,f as ae,g as re,h as se,I as ie,i as ce,m as de,l as le,j as W,k as me,L as k,W as we,A as he,X as ue,o as pe,R as ge,p as fe}from"./DragControls-ALxf4ldN.js";import{S as Me}from"./STLLoader-DEcdGH4u.js";let v,h,d,s,f,M,b,S,E,y;const R=[];let g,w;const u=[],F=[[new r(-10,0,10),new r(-5,5,5),new r(5,5,5),new r(5,-5,5),new r(10,0,10),new r(-10,0,10)]];new N(0,0,10,5);new r;const B=[],P=new Y;be();function be(){var O;v=document.createElement("div"),document.body.appendChild(v),d=new J,d.background=new K("skyblue"),h=new Q(50,window.innerWidth/window.innerHeight,.1,2e3),h.position.set(10,10,10),g=new Z(h,v),g.target.set(0,1.6,0),g.update();const e=new _(6,6),o=new $({opacity:.25,blending:ee,transparent:!1}),a=new D(e,o);a.rotation.x=-Math.PI/2,a.receiveShadow=!0,d.add(a),d.add(new te(12369084,10855845,3));const t=new ne("0xffffff",3);t.position.set(0,6,0),t.castShadow=!0,t.shadow.camera.top=3,t.shadow.camera.bottom=-3,t.shadow.camera.right=3,t.shadow.camera.left=-3,t.shadow.mapSize.set(4096,4096),d.add(t),w=new oe,d.add(w);const m=[new ae(.2,.2,.2),new re(.2,.2,64),new se(.2,.2,.2,64),new ie(.2,8),new ce(.2,.04,64,32)];for(let l=0;l<1;l++){const i=m[Math.floor(Math.random()*m.length)],c=new de({color:Math.random()*16777215,roughness:.7,metalness:0}),n=new D(i,c);n.position.x=Math.random()*4-2,n.position.y=Math.random()*2,n.position.z=Math.random()*4-2,n.rotation.x=Math.random()*2*Math.PI,n.rotation.y=Math.random()*2*Math.PI,n.rotation.z=Math.random()*2*Math.PI,n.scale.setScalar(Math.random()+.5),n.castShadow=!0,n.receiveShadow=!0,w.add(n),u.push(n)}new r(-10,0,10),new r(-5,5,5),new r(5,5,5),new r(5,-5,5),new r(10,0,10),new r(-10,0,10),F.map(l=>{const i=new le(l),c=new W().setFromPoints(i.getPoints(50)),n=new me({color:16777215}),V=new k(c,n);d.add(V),B.push(i)}),s=new we({antialias:!0,preserveDrawingBuffer:!0}),s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),s.setAnimationLoop(z),s.shadowMap.enabled=!0,s.xr.enabled=!0,v.appendChild(s.domElement),f=s.xr.getController(0),f.addEventListener("selectstart",H),f.addEventListener("selectend",A),d.add(f),M=s.xr.getController(1),M.addEventListener("selectstart",H),M.addEventListener("selectend",A),d.add(M);const j=new he(1e3);d.add(j);const x=new ue;S=s.xr.getControllerGrip(0),S.add(x.createControllerModel(S)),d.add(S),E=s.xr.getControllerGrip(1),E.add(x.createControllerModel(E)),d.add(E),b=new pe([...u],h,s.domElement),b.rotateSpeed=2,b.addEventListener("drag",z),b.addEventListener("dragstart",function(){g.enabled=!1}),b.addEventListener("dragend",function(){g.enabled=!0});const C=new W().setFromPoints([new r(0,0,0),new r(0,0,-1)]),p=new k(C);p.name="line",p.scale.z=5,f.add(p.clone()),M.add(p.clone()),y=new ge,window.addEventListener("resize",ve),document.addEventListener("click",je);const L=v.querySelector("canvas");L&&L.addEventListener("dragover",l=>{l.preventDefault()});const q=new Me,G=document.querySelector("#file");G==null||G.addEventListener("change",l=>{q.load(URL.createObjectURL(l.target.files[0]),i=>{const c=new fe({color:Math.random()*16777215,specular:1118481,shininess:200}),n=new D(i,c);n.position.x=Math.random()*4-2,n.position.y=Math.random()*2,n.position.z=Math.random()*4-2,n.scale.setScalar(Math.random()+.5),n.castShadow=!0,n.receiveShadow=!0,i.center(),w.add(n),u.push(n)})});const T=()=>{let l;try{const i="image/jpeg",c="image/octet-stream";l=s.domElement.toDataURL(i),U(l.replace(i,c),"snapshot.jpg")}catch(i){console.log(i);return}},U=(l,i)=>{const c=document.createElement("a");typeof c.download=="string"?(document.body.appendChild(c),c.download=i,c.href=l,c.click(),document.body.removeChild(c)):location.replace(uri)};(O=document.querySelector("#snapshot button"))==null||O.addEventListener("click",T)}function ve(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}function H(e){const o=e.target,a=X(o);if(a.length>0){const m=a[0].object;m.material.emissive.b=1,o.attach(m),o.userData.selected=m}o.userData.targetRayMode=e.data.targetRayMode}function A(e){const o=e.target;if(o.userData.selected!==void 0){const a=o.userData.selected;a.material.emissive.b=0,w.attach(a),o.userData.selected=void 0}}function X(e){return e.updateMatrixWorld(),y.setFromXRController(e),y.intersectObjects(w.children,!1)}function I(e){if(e.userData.targetRayMode==="screen"||e.userData.selected!==void 0)return;const o=e.getObjectByName("line"),a=X(e);if(a.length>0){const t=a[0],m=t.object;m.material.emissive.r=1,R.push(m),o.scale.z=t.distance}else o.scale.z=5}function ye(){for(;R.length;){const e=R.pop();e.material.emissive.r=0}}function je(e){if(!e.target.closest("canvas"))return;e.preventDefault();const o=b.getObjects();o.length=0,P.x=e.clientX/window.innerWidth*2-1,P.y=-(e.clientY/window.innerHeight)*2+1,y.setFromCamera(P,h);const a=y.intersectObjects(u,!0);if(a.length>0){const t=a[0].object;w.children.includes(t)===!0?(t.material.emissive.set(0),d.attach(t)):(t.material.emissive.set(11184810),w.attach(t)),g.transformGroup=!0,o.push(w)}w.children.length===0&&(g.transformGroup=!1,o.push(...u)),z()}function Ce(){B.forEach((a,t)=>{const m=u[t],j=F[t].length+1,C=Date.now()/(t*500+1e3)%j/j,p=a.getPointAt(C);m.position.copy(p);const L=a.getTangentAt(C).normalize();m.lookAt(p.clone().add(L))});const e=new r(10,10,10),o=new r;u[0].getWorldPosition(o),u[0],h.position.copy(o).add(e)}function z(){ye(),I(f),I(M),Ce(),s.render(d,h)}
