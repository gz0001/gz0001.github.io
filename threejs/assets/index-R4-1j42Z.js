import{T as Ue,S as ue,C as pe,P as fe,O as ge,H as ye,D as Ee,G as Oe,W as Te,a as ve,V as x,B as Se,E as Ae,b as Pe,c as Me,d as Fe,e as ze,M as zt,f as Re,g as ke,h as Ie,I as He,i as Ye,L as it,j as ot,k as mt,l as Ve,m as Ze,n as Be,X as Ne,o as je,R as Ke,p as Xe,q as Ge}from"./STLLoader-YyqC77xd.js";/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const M={LEFT:1,RIGHT:2,MIDDLE:4},o=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),nt={NONE:0,IN:1,OUT:-1};function Q(n){return n.isPerspectiveCamera}function W(n){return n.isOrthographicCamera}const at=Math.PI*2,$t=Math.PI/2,we=1e-5,ut=Math.PI/180;function B(n,t,s){return Math.max(t,Math.min(s,n))}function A(n,t=we){return Math.abs(n)<t}function b(n,t,s=we){return A(n-t,s)}function Jt(n,t){return Math.round(n/t)*t}function pt(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function ft(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function wt(n,t,s,e,i=1/0,a){e=Math.max(1e-4,e);const r=2/e,l=r*a,c=1/(1+l+.48*l*l+.235*l*l*l);let d=n-t;const E=t,f=i*e;d=B(d,-f,f),t=n-d;const w=(s.value+r*d)*a;s.value=(s.value-r*w)*c;let g=t+(d+w)*c;return E-n>0==g>E&&(g=E,s.value=(g-E)/a),g}function te(n,t,s,e,i=1/0,a,r){e=Math.max(1e-4,e);const l=2/e,c=l*a,d=1/(1+c+.48*c*c+.235*c*c*c);let E=t.x,f=t.y,w=t.z,g=n.x-E,U=n.y-f,v=n.z-w;const S=E,h=f,_=w,u=i*e,m=u*u,T=g*g+U*U+v*v;if(T>m){const C=Math.sqrt(T);g=g/C*u,U=U/C*u,v=v/C*u}E=n.x-g,f=n.y-U,w=n.z-v;const y=(s.x+l*g)*a,D=(s.y+l*U)*a,z=(s.z+l*v)*a;s.x=(s.x-l*y)*d,s.y=(s.y-l*D)*d,s.z=(s.z-l*z)*d,r.x=E+(g+y)*d,r.y=f+(U+D)*d,r.z=w+(v+z)*d;const G=S-n.x,N=h-n.y,et=_-n.z,st=r.x-S,P=r.y-h,F=r.z-_;return G*st+N*P+et*F>0&&(r.x=S,r.y=h,r.z=_,s.x=(r.x-S)/a,s.y=(r.y-h)/a,s.z=(r.z-_)/a),r}function Rt(n,t){t.set(0,0),n.forEach(s=>{t.x+=s.clientX,t.y+=s.clientY}),t.x/=n.length,t.y/=n.length}function kt(n,t){return W(n)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class qe{constructor(){this._listeners={}}addEventListener(t,s){const e=this._listeners;e[t]===void 0&&(e[t]=[]),e[t].indexOf(s)===-1&&e[t].push(s)}hasEventListener(t,s){const e=this._listeners;return e[t]!==void 0&&e[t].indexOf(s)!==-1}removeEventListener(t,s){const i=this._listeners[t];if(i!==void 0){const a=i.indexOf(s);a!==-1&&i.splice(a,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const e=this._listeners[t.type];if(e!==void 0){t.target=this;const i=e.slice(0);for(let a=0,r=i.length;a<r;a++)i[a].call(this,t)}}}var It;const We="2.9.0",Ct=1/8,Qe=/Mac/.test((It=globalThis==null?void 0:globalThis.navigator)===null||It===void 0?void 0:It.platform);let p,ee,xt,Ht,I,O,L,rt,gt,j,K,$,se,ie,V,yt,ht,oe,Yt,ne,Vt,Zt,Lt;class Tt extends qe{static install(t){p=t.THREE,ee=Object.freeze(new p.Vector3(0,0,0)),xt=Object.freeze(new p.Vector3(0,1,0)),Ht=Object.freeze(new p.Vector3(0,0,1)),I=new p.Vector2,O=new p.Vector3,L=new p.Vector3,rt=new p.Vector3,gt=new p.Vector3,j=new p.Vector3,K=new p.Vector3,$=new p.Vector3,se=new p.Vector3,ie=new p.Vector3,V=new p.Spherical,yt=new p.Spherical,ht=new p.Box3,oe=new p.Box3,Yt=new p.Sphere,ne=new p.Quaternion,Vt=new p.Quaternion,Zt=new p.Matrix4,Lt=new p.Raycaster}static get ACTION(){return o}constructor(t,s){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=o.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=nt.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new p.Vector3,this._focalOffsetVelocity=new p.Vector3,this._zoomVelocity={value:0},this._truckInternal=(h,_,u)=>{let m,T;if(Q(this._camera)){const y=O.copy(this._camera.position).sub(this._target),D=this._camera.getEffectiveFOV()*ut,z=y.length()*Math.tan(D*.5);m=this.truckSpeed*h*z/this._elementRect.height,T=this.truckSpeed*_*z/this._elementRect.height}else if(W(this._camera)){const y=this._camera;m=h*(y.right-y.left)/y.zoom/this._elementRect.width,T=_*(y.top-y.bottom)/y.zoom/this._elementRect.height}else return;this.verticalDragToForward?(u?this.setFocalOffset(this._focalOffsetEnd.x+m,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(m,0,!0),this.forward(-T,!0)):u?this.setFocalOffset(this._focalOffsetEnd.x+m,this._focalOffsetEnd.y+T,this._focalOffsetEnd.z,!0):this.truck(m,T,!0)},this._rotateInternal=(h,_)=>{const u=at*this.azimuthRotateSpeed*h/this._elementRect.height,m=at*this.polarRotateSpeed*_/this._elementRect.height;this.rotate(u,m,!0)},this._dollyInternal=(h,_,u)=>{const m=Math.pow(.95,-h*this.dollySpeed),T=this._sphericalEnd.radius,y=this._sphericalEnd.radius*m,D=B(y,this.minDistance,this.maxDistance),z=D-y;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(y,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(z,!0),this._dollyToNoClamp(D,!0)):this._dollyToNoClamp(D,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?y:D)-T,this._dollyControlCoord.set(_,u)),this._lastDollyDirection=Math.sign(-h)},this._zoomInternal=(h,_,u)=>{const m=Math.pow(.95,h*this.dollySpeed),T=this._zoom,y=this._zoom*m;this.zoomTo(y,!0),this.dollyToCursor&&(this._changedZoom+=y-T,this._dollyControlCoord.set(_,u))},typeof p>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new p.Quaternion().setFromUnitVectors(this._camera.up,xt),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=o.NONE,this._target=new p.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new p.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new p.Spherical().setFromVector3(O.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new p.Vector3,new p.Vector3,new p.Vector3,new p.Vector3],this._updateNearPlaneCorners(),this._boundary=new p.Box3(new p.Vector3(-1/0,-1/0,-1/0),new p.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new p.Vector2,this.mouseButtons={left:o.ROTATE,middle:o.DOLLY,right:o.TRUCK,wheel:Q(this._camera)?o.DOLLY:W(this._camera)?o.ZOOM:o.NONE},this.touches={one:o.TOUCH_ROTATE,two:Q(this._camera)?o.TOUCH_DOLLY_TRUCK:W(this._camera)?o.TOUCH_ZOOM_TRUCK:o.NONE,three:o.TOUCH_TRUCK};const e=new p.Vector2,i=new p.Vector2,a=new p.Vector2,r=h=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const m=this._domElement.getBoundingClientRect(),T=h.clientX/m.width,y=h.clientY/m.height;if(T<this._interactiveArea.left||T>this._interactiveArea.right||y<this._interactiveArea.top||y>this._interactiveArea.bottom)return}const _=h.pointerType!=="mouse"?null:(h.buttons&M.LEFT)===M.LEFT?M.LEFT:(h.buttons&M.MIDDLE)===M.MIDDLE?M.MIDDLE:(h.buttons&M.RIGHT)===M.RIGHT?M.RIGHT:null;if(_!==null){const m=this._findPointerByMouseButton(_);m&&this._disposePointer(m)}if((h.buttons&M.LEFT)===M.LEFT&&this._lockedPointer)return;const u={pointerId:h.pointerId,clientX:h.clientX,clientY:h.clientY,deltaX:0,deltaY:0,mouseButton:_};this._activePointers.push(u),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,w(h)},l=h=>{h.cancelable&&h.preventDefault();const _=h.pointerId,u=this._lockedPointer||this._findPointerById(_);if(u){if(u.clientX=h.clientX,u.clientY=h.clientY,u.deltaX=h.movementX,u.deltaY=h.movementY,this._state=0,h.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(h.buttons&M.LEFT)===M.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(h.buttons&M.MIDDLE)===M.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(h.buttons&M.RIGHT)===M.RIGHT&&(this._state=this._state|this.mouseButtons.right);g()}},c=h=>{const _=this._findPointerById(h.pointerId);if(!(_&&_===this._lockedPointer)){if(_&&this._disposePointer(_),h.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=o.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=o.NONE;U()}};let d=-1;const E=h=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===o.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const y=this._domElement.getBoundingClientRect(),D=h.clientX/y.width,z=h.clientY/y.height;if(D<this._interactiveArea.left||D>this._interactiveArea.right||z<this._interactiveArea.top||z>this._interactiveArea.bottom)return}if(h.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===o.ROTATE||this.mouseButtons.wheel===o.TRUCK){const y=performance.now();d-y<1e3&&this._getClientRect(this._elementRect),d=y}const _=Qe?-1:-3,u=h.deltaMode===1?h.deltaY/_:h.deltaY/(_*10),m=this.dollyToCursor?(h.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,T=this.dollyToCursor?(h.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case o.ROTATE:{this._rotateInternal(h.deltaX,h.deltaY),this._isUserControllingRotate=!0;break}case o.TRUCK:{this._truckInternal(h.deltaX,h.deltaY,!1),this._isUserControllingTruck=!0;break}case o.OFFSET:{this._truckInternal(h.deltaX,h.deltaY,!0),this._isUserControllingOffset=!0;break}case o.DOLLY:{this._dollyInternal(-u,m,T),this._isUserControllingDolly=!0;break}case o.ZOOM:{this._zoomInternal(-u,m,T),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},f=h=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Tt.ACTION.NONE){const _=h instanceof PointerEvent?h.pointerId:0,u=this._findPointerById(_);u&&this._disposePointer(u),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c);return}h.preventDefault()}},w=h=>{if(!this._enabled)return;if(Rt(this._activePointers,I),this._getClientRect(this._elementRect),e.copy(I),i.copy(I),this._activePointers.length>=2){const u=I.x-this._activePointers[1].clientX,m=I.y-this._activePointers[1].clientY,T=Math.sqrt(u*u+m*m);a.set(0,T);const y=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,D=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(y,D)}if(this._state=0,!h)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in h&&h.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(h.buttons&M.LEFT)===M.LEFT&&(this._state=this._state|this.mouseButtons.left),(h.buttons&M.MIDDLE)===M.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(h.buttons&M.RIGHT)===M.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&o.ROTATE)===o.ROTATE||(this._state&o.TOUCH_ROTATE)===o.TOUCH_ROTATE||(this._state&o.TOUCH_DOLLY_ROTATE)===o.TOUCH_DOLLY_ROTATE||(this._state&o.TOUCH_ZOOM_ROTATE)===o.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&o.TRUCK)===o.TRUCK||(this._state&o.TOUCH_TRUCK)===o.TOUCH_TRUCK||(this._state&o.TOUCH_DOLLY_TRUCK)===o.TOUCH_DOLLY_TRUCK||(this._state&o.TOUCH_ZOOM_TRUCK)===o.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&o.DOLLY)===o.DOLLY||(this._state&o.TOUCH_DOLLY)===o.TOUCH_DOLLY||(this._state&o.TOUCH_DOLLY_TRUCK)===o.TOUCH_DOLLY_TRUCK||(this._state&o.TOUCH_DOLLY_OFFSET)===o.TOUCH_DOLLY_OFFSET||(this._state&o.TOUCH_DOLLY_ROTATE)===o.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&o.ZOOM)===o.ZOOM||(this._state&o.TOUCH_ZOOM)===o.TOUCH_ZOOM||(this._state&o.TOUCH_ZOOM_TRUCK)===o.TOUCH_ZOOM_TRUCK||(this._state&o.TOUCH_ZOOM_OFFSET)===o.TOUCH_ZOOM_OFFSET||(this._state&o.TOUCH_ZOOM_ROTATE)===o.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&o.OFFSET)===o.OFFSET||(this._state&o.TOUCH_OFFSET)===o.TOUCH_OFFSET||(this._state&o.TOUCH_DOLLY_OFFSET)===o.TOUCH_DOLLY_OFFSET||(this._state&o.TOUCH_ZOOM_OFFSET)===o.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},g=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Rt(this._activePointers,I);const _=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,u=_?-_.deltaX:i.x-I.x,m=_?-_.deltaY:i.y-I.y;if(i.copy(I),((this._state&o.ROTATE)===o.ROTATE||(this._state&o.TOUCH_ROTATE)===o.TOUCH_ROTATE||(this._state&o.TOUCH_DOLLY_ROTATE)===o.TOUCH_DOLLY_ROTATE||(this._state&o.TOUCH_ZOOM_ROTATE)===o.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(u,m),this._isUserControllingRotate=!0),(this._state&o.DOLLY)===o.DOLLY||(this._state&o.ZOOM)===o.ZOOM){const T=this.dollyToCursor?(e.x-this._elementRect.x)/this._elementRect.width*2-1:0,y=this.dollyToCursor?(e.y-this._elementRect.y)/this._elementRect.height*-2+1:0,D=this.dollyDragInverted?-1:1;(this._state&o.DOLLY)===o.DOLLY?(this._dollyInternal(D*m*Ct,T,y),this._isUserControllingDolly=!0):(this._zoomInternal(D*m*Ct,T,y),this._isUserControllingZoom=!0)}if((this._state&o.TOUCH_DOLLY)===o.TOUCH_DOLLY||(this._state&o.TOUCH_ZOOM)===o.TOUCH_ZOOM||(this._state&o.TOUCH_DOLLY_TRUCK)===o.TOUCH_DOLLY_TRUCK||(this._state&o.TOUCH_ZOOM_TRUCK)===o.TOUCH_ZOOM_TRUCK||(this._state&o.TOUCH_DOLLY_OFFSET)===o.TOUCH_DOLLY_OFFSET||(this._state&o.TOUCH_ZOOM_OFFSET)===o.TOUCH_ZOOM_OFFSET||(this._state&o.TOUCH_DOLLY_ROTATE)===o.TOUCH_DOLLY_ROTATE||(this._state&o.TOUCH_ZOOM_ROTATE)===o.TOUCH_ZOOM_ROTATE){const T=I.x-this._activePointers[1].clientX,y=I.y-this._activePointers[1].clientY,D=Math.sqrt(T*T+y*y),z=a.y-D;a.set(0,D);const G=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,N=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&o.TOUCH_DOLLY)===o.TOUCH_DOLLY||(this._state&o.TOUCH_DOLLY_ROTATE)===o.TOUCH_DOLLY_ROTATE||(this._state&o.TOUCH_DOLLY_TRUCK)===o.TOUCH_DOLLY_TRUCK||(this._state&o.TOUCH_DOLLY_OFFSET)===o.TOUCH_DOLLY_OFFSET?(this._dollyInternal(z*Ct,G,N),this._isUserControllingDolly=!0):(this._zoomInternal(z*Ct,G,N),this._isUserControllingZoom=!0)}((this._state&o.TRUCK)===o.TRUCK||(this._state&o.TOUCH_TRUCK)===o.TOUCH_TRUCK||(this._state&o.TOUCH_DOLLY_TRUCK)===o.TOUCH_DOLLY_TRUCK||(this._state&o.TOUCH_ZOOM_TRUCK)===o.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(u,m,!1),this._isUserControllingTruck=!0),((this._state&o.OFFSET)===o.OFFSET||(this._state&o.TOUCH_OFFSET)===o.TOUCH_OFFSET||(this._state&o.TOUCH_DOLLY_OFFSET)===o.TOUCH_DOLLY_OFFSET||(this._state&o.TOUCH_ZOOM_OFFSET)===o.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(u,m,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},U=()=>{Rt(this._activePointers,I),i.copy(I),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",v),this._domElement.ownerDocument.addEventListener("pointerlockerror",S),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),w())},this.unlockPointer=()=>{var h,_,u;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(h=this._domElement)===null||h===void 0||h.ownerDocument.exitPointerLock(),(_=this._domElement)===null||_===void 0||_.ownerDocument.removeEventListener("pointerlockchange",v),(u=this._domElement)===null||u===void 0||u.ownerDocument.removeEventListener("pointerlockerror",S),this.cancel()};const v=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},S=()=>{this.unlockPointer()};this._addAllEventListeners=h=>{this._domElement=h,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",r),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",E,{passive:!1}),this._domElement.addEventListener("contextmenu",f)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",r),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",E,{passive:!1}),this._domElement.removeEventListener("contextmenu",f),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",S))},this.cancel=()=>{this._state!==o.NONE&&(this._state=o.NONE,this._activePointers.length=0,U())},s&&this.connect(s),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=B(t.width,0,1),this._interactiveArea.height=B(t.height,0,1),this._interactiveArea.x=B(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=B(t.y,0,1-this._interactiveArea.height)}addEventListener(t,s){super.addEventListener(t,s)}removeEventListener(t,s){super.removeEventListener(t,s)}rotate(t,s,e=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+s,e)}rotateAzimuthTo(t,s=!1){return this.rotateTo(t,this._sphericalEnd.phi,s)}rotatePolarTo(t,s=!1){return this.rotateTo(this._sphericalEnd.theta,t,s)}rotateTo(t,s,e=!1){this._isUserControllingRotate=!1;const i=B(t,this.minAzimuthAngle,this.maxAzimuthAngle),a=B(s,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=a,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,e||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!e||b(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&b(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(t,s=!1){return this.dollyTo(this._sphericalEnd.radius-t,s)}dollyTo(t,s=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=nt.NONE,this._changedDolly=0,this._dollyToNoClamp(B(t,this.minDistance,this.maxDistance),s)}_dollyToNoClamp(t,s=!1){const e=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const r=this._collisionTest(),l=b(r,this._spherical.radius);if(!(e>t)&&l)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,r)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,s||(this._spherical.radius=this._sphericalEnd.radius);const a=!s||b(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(a)}dollyInFixed(t,s=!1){this._targetEnd.add(this._getCameraDirection(gt).multiplyScalar(t)),s||this._target.copy(this._targetEnd);const e=!s||b(this._target.x,this._targetEnd.x,this.restThreshold)&&b(this._target.y,this._targetEnd.y,this.restThreshold)&&b(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(e)}zoom(t,s=!1){return this.zoomTo(this._zoomEnd+t,s)}zoomTo(t,s=!1){this._isUserControllingZoom=!1,this._zoomEnd=B(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,s||(this._zoom=this._zoomEnd);const e=!s||b(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(e)}pan(t,s,e=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,s,e)}truck(t,s,e=!1){this._camera.updateMatrix(),j.setFromMatrixColumn(this._camera.matrix,0),K.setFromMatrixColumn(this._camera.matrix,1),j.multiplyScalar(t),K.multiplyScalar(-s);const i=O.copy(j).add(K),a=L.copy(this._targetEnd).add(i);return this.moveTo(a.x,a.y,a.z,e)}forward(t,s=!1){O.setFromMatrixColumn(this._camera.matrix,0),O.crossVectors(this._camera.up,O),O.multiplyScalar(t);const e=L.copy(this._targetEnd).add(O);return this.moveTo(e.x,e.y,e.z,s)}elevate(t,s=!1){return O.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+O.x,this._targetEnd.y+O.y,this._targetEnd.z+O.z,s)}moveTo(t,s,e,i=!1){this._isUserControllingTruck=!1;const a=O.set(t,s,e).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,a,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const r=!i||b(this._target.x,this._targetEnd.x,this.restThreshold)&&b(this._target.y,this._targetEnd.y,this.restThreshold)&&b(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(t,s,e,i=!1){const l=O.set(t,s,e).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(l.x,l.y,l.z,i)}fitToBox(t,s,{cover:e=!1,paddingLeft:i=0,paddingRight:a=0,paddingBottom:r=0,paddingTop:l=0}={}){const c=[],d=t.isBox3?ht.copy(t):ht.setFromObject(t);d.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const E=Jt(this._sphericalEnd.theta,$t),f=Jt(this._sphericalEnd.phi,$t);c.push(this.rotateTo(E,f,s));const w=O.setFromSpherical(this._sphericalEnd).normalize(),g=ne.setFromUnitVectors(w,Ht),U=b(Math.abs(w.y),1);U&&g.multiply(Vt.setFromAxisAngle(xt,E)),g.multiply(this._yAxisUpSpaceInverse);const v=oe.makeEmpty();L.copy(d.min).applyQuaternion(g),v.expandByPoint(L),L.copy(d.min).setX(d.max.x).applyQuaternion(g),v.expandByPoint(L),L.copy(d.min).setY(d.max.y).applyQuaternion(g),v.expandByPoint(L),L.copy(d.max).setZ(d.min.z).applyQuaternion(g),v.expandByPoint(L),L.copy(d.min).setZ(d.max.z).applyQuaternion(g),v.expandByPoint(L),L.copy(d.max).setY(d.min.y).applyQuaternion(g),v.expandByPoint(L),L.copy(d.max).setX(d.min.x).applyQuaternion(g),v.expandByPoint(L),L.copy(d.max).applyQuaternion(g),v.expandByPoint(L),v.min.x-=i,v.min.y-=r,v.max.x+=a,v.max.y+=l,g.setFromUnitVectors(Ht,w),U&&g.premultiply(Vt.invert()),g.premultiply(this._yAxisUpSpace);const S=v.getSize(O),h=v.getCenter(L).applyQuaternion(g);if(Q(this._camera)){const _=this.getDistanceToFitBox(S.x,S.y,S.z,e);c.push(this.moveTo(h.x,h.y,h.z,s)),c.push(this.dollyTo(_,s)),c.push(this.setFocalOffset(0,0,0,s))}else if(W(this._camera)){const _=this._camera,u=_.right-_.left,m=_.top-_.bottom,T=e?Math.max(u/S.x,m/S.y):Math.min(u/S.x,m/S.y);c.push(this.moveTo(h.x,h.y,h.z,s)),c.push(this.zoomTo(T,s)),c.push(this.setFocalOffset(0,0,0,s))}return Promise.all(c)}fitToSphere(t,s){const e=[],a="isObject3D"in t?Tt.createBoundingSphere(t,Yt):Yt.copy(t);if(e.push(this.moveTo(a.center.x,a.center.y,a.center.z,s)),Q(this._camera)){const r=this.getDistanceToFitSphere(a.radius);e.push(this.dollyTo(r,s))}else if(W(this._camera)){const r=this._camera.right-this._camera.left,l=this._camera.top-this._camera.bottom,c=2*a.radius,d=Math.min(r/c,l/c);e.push(this.zoomTo(d,s))}return e.push(this.setFocalOffset(0,0,0,s)),Promise.all(e)}setLookAt(t,s,e,i,a,r,l=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=nt.NONE,this._changedDolly=0;const c=L.set(i,a,r),d=O.set(t,s,e);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(d.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,l||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const E=!l||b(this._target.x,this._targetEnd.x,this.restThreshold)&&b(this._target.y,this._targetEnd.y,this.restThreshold)&&b(this._target.z,this._targetEnd.z,this.restThreshold)&&b(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&b(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&b(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(E)}lerpLookAt(t,s,e,i,a,r,l,c,d,E,f,w,g,U=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=nt.NONE,this._changedDolly=0;const v=O.set(i,a,r),S=L.set(t,s,e);V.setFromVector3(S.sub(v).applyQuaternion(this._yAxisUpSpace));const h=rt.set(E,f,w),_=L.set(l,c,d);yt.setFromVector3(_.sub(h).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(v.lerp(h,g));const u=yt.theta-V.theta,m=yt.phi-V.phi,T=yt.radius-V.radius;this._sphericalEnd.set(V.radius+T*g,V.phi+m*g,V.theta+u*g),this.normalizeRotations(),this._needsUpdate=!0,U||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const y=!U||b(this._target.x,this._targetEnd.x,this.restThreshold)&&b(this._target.y,this._targetEnd.y,this.restThreshold)&&b(this._target.z,this._targetEnd.z,this.restThreshold)&&b(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&b(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&b(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(y)}setPosition(t,s,e,i=!1){return this.setLookAt(t,s,e,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(t,s,e,i=!1){const a=this.getPosition(O),r=this.setLookAt(a.x,a.y,a.z,t,s,e,i);return this._sphericalEnd.phi=B(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(t,s,e,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,s,e),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const a=!i||b(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&b(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&b(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}setOrbitPoint(t,s,e){this._camera.updateMatrixWorld(),j.setFromMatrixColumn(this._camera.matrixWorldInverse,0),K.setFromMatrixColumn(this._camera.matrixWorldInverse,1),$.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=O.set(t,s,e),a=i.distanceTo(this._camera.position),r=i.sub(this._camera.position);j.multiplyScalar(r.x),K.multiplyScalar(r.y),$.multiplyScalar(r.z),O.copy(j).add(K).add($),O.z=O.z+a,this.dollyTo(a,!1),this.setFocalOffset(-O.x,O.y,-O.z,!1),this.moveTo(t,s,e,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,s,e,i){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new p.Vector4,typeof t=="number"?this._viewport.set(t,s,e,i):this._viewport.copy(t)}getDistanceToFitBox(t,s,e,i=!1){if(kt(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const a=t/s,r=this._camera.getEffectiveFOV()*ut,l=this._camera.aspect;return((i?a>l:a<l)?s:t/l)*.5/Math.tan(r*.5)+e*.5}getDistanceToFitSphere(t){if(kt(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const s=this._camera.getEffectiveFOV()*ut,e=Math.atan(Math.tan(s*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?s:e;return t/Math.sin(i*.5)}getTarget(t,s=!0){return(t&&t.isVector3?t:new p.Vector3).copy(s?this._targetEnd:this._target)}getPosition(t,s=!0){return(t&&t.isVector3?t:new p.Vector3).setFromSpherical(s?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(s?this._targetEnd:this._target)}getSpherical(t,s=!0){return(t||new p.Spherical).copy(s?this._sphericalEnd:this._spherical)}getFocalOffset(t,s=!0){return(t&&t.isVector3?t:new p.Vector3).copy(s?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%at,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=at),this._spherical.theta+=at*Math.round((this._sphericalEnd.theta-this._spherical.theta)/at)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!b(this._camera.up.x,this._cameraUp0.x)||!b(this._camera.up.y,this._cameraUp0.y)||!b(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const e=this.getPosition(O);this.updateCameraUp(),this.setPosition(e.x,e.y,e.z)}const s=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(s)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,xt),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=O.subVectors(this._target,this._camera.position).normalize(),s=L.crossVectors(t,this._camera.up);this._camera.up.crossVectors(s,t).normalize(),this._camera.updateMatrixWorld();const e=this.getPosition(O);this.updateCameraUp(),this.setPosition(e.x,e.y,e.z)}update(t){const s=this._sphericalEnd.theta-this._spherical.theta,e=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,a=se.subVectors(this._targetEnd,this._target),r=ie.subVectors(this._focalOffsetEnd,this._focalOffset),l=this._zoomEnd-this._zoom;if(A(s))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const f=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=wt(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,f,1/0,t),this._needsUpdate=!0}if(A(e))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const f=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=wt(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,f,1/0,t),this._needsUpdate=!0}if(A(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const f=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=wt(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,f,this.maxSpeed,t),this._needsUpdate=!0}if(A(a.x)&&A(a.y)&&A(a.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const f=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;te(this._target,this._targetEnd,this._targetVelocity,f,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(A(r.x)&&A(r.y)&&A(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const f=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;te(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,f,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(A(l))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const f=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=wt(this._zoom,this._zoomEnd,this._zoomVelocity,f,1/0,t)}if(this.dollyToCursor){if(Q(this._camera)&&this._changedDolly!==0){const f=this._spherical.radius-this._lastDistance,w=this._camera,g=this._getCameraDirection(gt),U=O.copy(g).cross(w.up).normalize();U.lengthSq()===0&&(U.x=1);const v=L.crossVectors(U,g),S=this._sphericalEnd.radius*Math.tan(w.getEffectiveFOV()*ut*.5),_=(this._sphericalEnd.radius-f-this._sphericalEnd.radius)/this._sphericalEnd.radius,u=rt.copy(this._targetEnd).add(U.multiplyScalar(this._dollyControlCoord.x*S*w.aspect)).add(v.multiplyScalar(this._dollyControlCoord.y*S)),m=O.copy(this._targetEnd).lerp(u,_),T=this._lastDollyDirection===nt.IN&&this._spherical.radius<=this.minDistance,y=this._lastDollyDirection===nt.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(T||y)){this._sphericalEnd.radius-=f,this._spherical.radius-=f;const z=L.copy(g).multiplyScalar(-f);m.add(z)}this._boundary.clampPoint(m,m);const D=L.subVectors(m,this._targetEnd);this._targetEnd.copy(m),this._target.add(D),this._changedDolly-=f,A(this._changedDolly)&&(this._changedDolly=0)}else if(W(this._camera)&&this._changedZoom!==0){const f=this._zoom-this._lastZoom,w=this._camera,g=O.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(w.near+w.far)/(w.near-w.far)).unproject(w),U=L.set(0,0,-1).applyQuaternion(w.quaternion),v=rt.copy(g).add(U.multiplyScalar(-g.dot(w.up))),h=-(this._zoom-f-this._zoom)/this._zoom,_=this._getCameraDirection(gt),u=this._targetEnd.dot(_),m=O.copy(this._targetEnd).lerp(v,h),T=m.dot(_),y=_.multiplyScalar(T-u);m.sub(y),this._boundary.clampPoint(m,m);const D=L.subVectors(m,this._targetEnd);this._targetEnd.copy(m),this._target.add(D),this._changedZoom-=f,A(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!A(this._focalOffset.x)||!A(this._focalOffset.y)||!A(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),j.setFromMatrixColumn(this._camera.matrix,0),K.setFromMatrixColumn(this._camera.matrix,1),$.setFromMatrixColumn(this._camera.matrix,2),j.multiplyScalar(this._focalOffset.x),K.multiplyScalar(-this._focalOffset.y),$.multiplyScalar(this._focalOffset.z),O.copy(j).add(K).add($),this._camera.position.add(O)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),O.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const E=this._needsUpdate;return E&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):E?(this.dispatchEvent({type:"update"}),A(s,this.restThreshold)&&A(e,this.restThreshold)&&A(i,this.restThreshold)&&A(a.x,this.restThreshold)&&A(a.y,this.restThreshold)&&A(a.z,this.restThreshold)&&A(r.x,this.restThreshold)&&A(r.y,this.restThreshold)&&A(r.z,this.restThreshold)&&A(l,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!E&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=E,this._needsUpdate=!1,E}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:pt(this.maxDistance),minZoom:this.minZoom,maxZoom:pt(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:pt(this.maxPolarAngle),minAzimuthAngle:pt(this.minAzimuthAngle),maxAzimuthAngle:pt(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:O.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,s=!1){const e=JSON.parse(t);this.enabled=e.enabled,this.minDistance=e.minDistance,this.maxDistance=ft(e.maxDistance),this.minZoom=e.minZoom,this.maxZoom=ft(e.maxZoom),this.minPolarAngle=e.minPolarAngle,this.maxPolarAngle=ft(e.maxPolarAngle),this.minAzimuthAngle=ft(e.minAzimuthAngle),this.maxAzimuthAngle=ft(e.maxAzimuthAngle),this.smoothTime=e.smoothTime,this.draggingSmoothTime=e.draggingSmoothTime,this.dollySpeed=e.dollySpeed,this.truckSpeed=e.truckSpeed,this.dollyToCursor=e.dollyToCursor,this.verticalDragToForward=e.verticalDragToForward,this._target0.fromArray(e.target0),this._position0.fromArray(e.position0),this._zoom0=e.zoom0,this._focalOffset0.fromArray(e.focalOffset0),this.moveTo(e.target[0],e.target[1],e.target[2],s),V.setFromVector3(O.fromArray(e.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(V.theta,V.phi,s),this.dollyTo(V.radius,s),this.zoomTo(e.zoom,s),this.setFocalOffset(e.focalOffset[0],e.focalOffset[1],e.focalOffset[2],s),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",We),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(s=>s.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(s=>s.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,s,e){const i=s.lengthSq();if(i===0)return t;const a=L.copy(s).add(t),l=this._boundary.clampPoint(a,rt).sub(a),c=l.lengthSq();if(c===0)return t.add(s);if(c===i)return t;if(e===0)return t.add(s).add(l);{const d=1+e*c/s.dot(l);return t.add(L.copy(s).multiplyScalar(d)).add(l.multiplyScalar(1-e))}}_updateNearPlaneCorners(){if(Q(this._camera)){const t=this._camera,s=t.near,e=t.getEffectiveFOV()*ut,i=Math.tan(e*.5)*s,a=i*t.aspect;this._nearPlaneCorners[0].set(-a,-i,0),this._nearPlaneCorners[1].set(a,-i,0),this._nearPlaneCorners[2].set(a,i,0),this._nearPlaneCorners[3].set(-a,i,0)}else if(W(this._camera)){const t=this._camera,s=1/t.zoom,e=t.left*s,i=t.right*s,a=t.top*s,r=t.bottom*s;this._nearPlaneCorners[0].set(e,a,0),this._nearPlaneCorners[1].set(i,a,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(e,r,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||kt(this._camera,"_collisionTest"))return t;const e=this._getTargetDirection(gt);Zt.lookAt(ee,e,this._camera.up);for(let i=0;i<4;i++){const a=L.copy(this._nearPlaneCorners[i]);a.applyMatrix4(Zt);const r=rt.addVectors(this._target,a);Lt.set(r,e),Lt.far=this._spherical.radius+1;const l=Lt.intersectObjects(this.colliderMeshes);l.length!==0&&l[0].distance<t&&(t=l[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const s=this._domElement.getBoundingClientRect();return t.x=s.left,t.y=s.top,this._viewport?(t.x+=this._viewport.x,t.y+=s.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=s.width,t.height=s.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(s=>{const e=()=>{this.removeEventListener("rest",e),s()};this.addEventListener("rest",e)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,s=new p.Sphere){const e=s,i=e.center;ht.makeEmpty(),t.traverseVisible(r=>{r.isMesh&&ht.expandByObject(r)}),ht.getCenter(i);let a=0;return t.traverseVisible(r=>{if(!r.isMesh)return;const l=r,c=l.geometry.clone();c.applyMatrix4(l.matrixWorld);const E=c.attributes.position;for(let f=0,w=E.count;f<w;f++)O.fromBufferAttribute(E,f),a=Math.max(a,i.distanceToSquared(O))}),e.radius=Math.sqrt(a),e}}Tt.install({THREE:Ue});const $e=n=>{const t=document.createElement("div");t.style.width="100vw",t.style.height="100vh";const s=new ve,e=new ue;e.background=new pe("skyblue");const i=new fe(50,window.innerWidth/window.innerHeight,.1,2e3);i.position.set(1,1,1);const a=new ge(i,t);a.target.set(0,1.6,0),a.update(),e.add(new ye(12369084,10855845,3));const r=new Ee("0xffffff",3);r.position.set(0,6,0),r.castShadow=!0,r.shadow.camera.top=3,r.shadow.camera.bottom=-3,r.shadow.camera.right=3,r.shadow.camera.left=-3,r.shadow.mapSize.set(4096,4096),e.add(r);const l=new Oe,c=n.clone();c.position.set(0,0,0),l.add(c),e.add(l);const d=new Te({antialias:!0,preserveDrawingBuffer:!0});d.setPixelRatio(window.devicePixelRatio),d.setSize(window.innerWidth,window.innerHeight),d.shadowMap.enabled=!0,d.xr.enabled=!0,t.appendChild(d.domElement);const E=new Tt(i,d.domElement);E.fitToBox(l),E.zoomTo(1);const f=s.getDelta();E.update(f),d.render(e,i);const w=d.domElement.toDataURL("image/jpeg");return t.remove(),d.dispose(),a.dispose(),E.dispose(),w},Dt=new x,ae=new x,bt=new Se;function Ce(n,t,s,e){bt.makeEmpty(),bt.expandByObject(n),bt.getSize(Dt),bt.getCenter(ae);const i=e?.5:4,r=Math.max(Dt.x,Dt.y,Dt.z)/(2*Math.atan(Math.PI*t.fov/360)),l=r/t.aspect,c=i*Math.max(r,l),d=s.target.clone().sub(t.position).normalize().multiplyScalar(c);s.maxDistance=c*10,s.target.copy(ae),t.near=c/100,t.far=c*100,t.updateProjectionMatrix(),t.position.copy(s.target).sub(d),s.update()}function Je(n,t,s){const e=new x;n.getWorldPosition(e);const i=new x;n.getWorldDirection(i);const a=s?-.5:-3,r=e.clone().add(i.clone().multiplyScalar(a));t.position.copy(r),t.rotation.copy(n.rotation),t.lookAt(e)}function ts(n,t){for(var s=0;s<t.length;s++){var e=t[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}function Ut(n){return function(t){if(Array.isArray(t))return Bt(t)}(n)||function(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}(n)||function(t,s){if(t){if(typeof t=="string")return Bt(t,s);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Bt(t,s)}}(n)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Bt(n,t){(t==null||t>n.length)&&(t=n.length);for(var s=0,e=new Array(t);s<t;s++)e[s]=n[s];return e}var re,Nt,J,jt,he,Mt=(re=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],Nt=function(){function n(e){var i=e.targetModal,a=e.triggers,r=a===void 0?[]:a,l=e.onShow,c=l===void 0?function(){}:l,d=e.onClose,E=d===void 0?function(){}:d,f=e.openTrigger,w=f===void 0?"data-micromodal-trigger":f,g=e.closeTrigger,U=g===void 0?"data-micromodal-close":g,v=e.openClass,S=v===void 0?"is-open":v,h=e.disableScroll,_=h!==void 0&&h,u=e.disableFocus,m=u!==void 0&&u,T=e.awaitCloseAnimation,y=T!==void 0&&T,D=e.awaitOpenAnimation,z=D!==void 0&&D,G=e.debugMode,N=G!==void 0&&G;(function(et,st){if(!(et instanceof st))throw new TypeError("Cannot call a class as a function")})(this,n),this.modal=document.getElementById(i),this.config={debugMode:N,disableScroll:_,openTrigger:w,closeTrigger:U,openClass:S,onShow:c,onClose:E,awaitCloseAnimation:y,awaitOpenAnimation:z,disableFocus:m},r.length>0&&this.registerTriggers.apply(this,Ut(r)),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this)}var t,s;return t=n,(s=[{key:"registerTriggers",value:function(){for(var e=this,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];a.filter(Boolean).forEach(function(l){l.addEventListener("click",function(c){return e.showModal(c)})})}},{key:"showModal",value:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(this.activeElement=document.activeElement,this.modal.setAttribute("aria-hidden","false"),this.modal.classList.add(this.config.openClass),this.scrollBehaviour("disable"),this.addEventListeners(),this.config.awaitOpenAnimation){var a=function r(){e.modal.removeEventListener("animationend",r,!1),e.setFocusToFirstNode()};this.modal.addEventListener("animationend",a,!1)}else this.setFocusToFirstNode();this.config.onShow(this.modal,this.activeElement,i)}},{key:"closeModal",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,i=this.modal;if(this.modal.setAttribute("aria-hidden","true"),this.removeEventListeners(),this.scrollBehaviour("enable"),this.activeElement&&this.activeElement.focus&&this.activeElement.focus(),this.config.onClose(this.modal,this.activeElement,e),this.config.awaitCloseAnimation){var a=this.config.openClass;this.modal.addEventListener("animationend",function r(){i.classList.remove(a),i.removeEventListener("animationend",r,!1)},!1)}else i.classList.remove(this.config.openClass)}},{key:"closeModalById",value:function(e){this.modal=document.getElementById(e),this.modal&&this.closeModal()}},{key:"scrollBehaviour",value:function(e){if(this.config.disableScroll){var i=document.querySelector("body");switch(e){case"enable":Object.assign(i.style,{overflow:""});break;case"disable":Object.assign(i.style,{overflow:"hidden"})}}}},{key:"addEventListeners",value:function(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown)}},{key:"removeEventListeners",value:function(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeydown)}},{key:"onClick",value:function(e){(e.target.hasAttribute(this.config.closeTrigger)||e.target.parentNode.hasAttribute(this.config.closeTrigger))&&(e.preventDefault(),e.stopPropagation(),this.closeModal(e))}},{key:"onKeydown",value:function(e){e.keyCode===27&&this.closeModal(e),e.keyCode===9&&this.retainFocus(e)}},{key:"getFocusableNodes",value:function(){var e=this.modal.querySelectorAll(re);return Array.apply(void 0,Ut(e))}},{key:"setFocusToFirstNode",value:function(){var e=this;if(!this.config.disableFocus){var i=this.getFocusableNodes();if(i.length!==0){var a=i.filter(function(r){return!r.hasAttribute(e.config.closeTrigger)});a.length>0&&a[0].focus(),a.length===0&&i[0].focus()}}}},{key:"retainFocus",value:function(e){var i=this.getFocusableNodes();if(i.length!==0)if(i=i.filter(function(r){return r.offsetParent!==null}),this.modal.contains(document.activeElement)){var a=i.indexOf(document.activeElement);e.shiftKey&&a===0&&(i[i.length-1].focus(),e.preventDefault()),!e.shiftKey&&i.length>0&&a===i.length-1&&(i[0].focus(),e.preventDefault())}else i[0].focus()}}])&&ts(t.prototype,s),n}(),J=null,jt=function(n){if(!document.getElementById(n))return console.warn("MicroModal: Seems like you have missed %c'".concat(n,"'"),"background-color: #f8f9fa;color: #50596c;font-weight: bold;","ID somewhere in your code. Refer example below to resolve it."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<div class="modal" id="'.concat(n,'"></div>')),!1},he=function(n,t){if(function(e){e.length<=0&&(console.warn("MicroModal: Please specify at least one %c'micromodal-trigger'","background-color: #f8f9fa;color: #50596c;font-weight: bold;","data attribute."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<a href="#" data-micromodal-trigger="my-modal"></a>'))}(n),!t)return!0;for(var s in t)jt(s);return!0},{init:function(n){var t=Object.assign({},{openTrigger:"data-micromodal-trigger"},n),s=Ut(document.querySelectorAll("[".concat(t.openTrigger,"]"))),e=function(r,l){var c=[];return r.forEach(function(d){var E=d.attributes[l].value;c[E]===void 0&&(c[E]=[]),c[E].push(d)}),c}(s,t.openTrigger);if(t.debugMode!==!0||he(s,e)!==!1)for(var i in e){var a=e[i];t.targetModal=i,t.triggers=Ut(a),J=new Nt(t)}},show:function(n,t){var s=t||{};s.targetModal=n,s.debugMode===!0&&jt(n)===!1||(J&&J.removeEventListeners(),(J=new Nt(s)).showModal())},close:function(n){n?J.closeModalById(n):J.closeModal()}});typeof window<"u"&&(window.MicroModal=Mt);let Et,Z,R,k,lt,ct,dt,St,At,vt;const qt=[];let q,X;const H=[],Pt=[],xe=[];let _t=null,Kt=0,Ot=new x,le;const es=[[new x(-10,0,10),new x(-5,5,5),new x(5,5,5),new x(5,-5,5),new x(10,0,10),new x(-10,0,10)],[new x(-10,0,-20),new x(50,10,10)],[new x(50,30,60),new x(20,10,55),new x(10,20,5),new x(20,10,35),new x(50,30,60)],[new x(-40,20,-20),new x(-20,10,25),new x(-10,20,5),new x(-40,20,-20)]],ss=new ve,Ft=new Ae(0,0,10,5);let ce;const Xt=new x,Wt=[],Gt=new Pe;let tt="fixed";is();function is(){var st;Mt.init(),Et=document.createElement("div"),document.body.appendChild(Et),R=new ue,R.background=new pe("skyblue"),Z=new fe(50,window.innerWidth/window.innerHeight,.1,2e3),Z.position.set(10,10,10),q=new ge(Z,Et),q.target.set(0,1.6,0),q.update();const n=new Me(6,6),t=new Fe({opacity:.25,blending:ze,transparent:!1}),s=new zt(n,t);s.rotation.x=-Math.PI/2,s.receiveShadow=!0,R.add(s),R.add(new ye(12369084,10855845,3));const e=new Ee("0xffffff",3);e.position.set(0,6,0),e.castShadow=!0,e.shadow.camera.top=3,e.shadow.camera.bottom=-3,e.shadow.camera.right=3,e.shadow.camera.left=-3,e.shadow.mapSize.set(4096,4096),R.add(e),X=new Oe,R.add(X);const i=[new Re(.2,.2,.2),new ke(.2,.2,64),new Ie(.2,.2,.2,64),new He(.2,8),new Ye(.2,.04,64,32)];ce=new it(new ot().setFromPoints(Ft.getSpacedPoints(100)),new mt({color:"black"})),R.add(ce),Wt.push(Ft),es.map(P=>{const F=new Ve(P),C=new ot().setFromPoints(F.getPoints(50)),Y=new mt({color:0}),be=new it(C,Y);R.add(be),Wt.push(F)}),document.querySelectorAll(".nav-item").forEach(P=>{P.addEventListener("dragend",F=>{Ot.set(F.clientX/window.innerWidth*2-1,-(F.clientY/window.innerHeight)*2+1,.9),Ot.unproject(Z);const C=P.getAttribute("data-type");le=i[C],Mt.show("modal-1")})}),document.querySelectorAll(".js-add-obj").forEach(P=>{P.addEventListener("click",()=>{const F=new Ze({color:Math.random()*16777215,roughness:.7,metalness:0}),C=new zt(le,F);C.position.x=Ot.x,C.position.y=Ot.y,C.position.z=Ot.z,C.rotation.x=Math.random()*2*Math.PI,C.rotation.y=Math.random()*2*Math.PI,C.rotation.z=Math.random()*2*Math.PI,C.scale.setScalar(Math.random()+.5),C.castShadow=!0,C.receiveShadow=!0,X.add(C),H.push(C),P.classList.contains("js-add-path")&&xe.push({objIndex:H.length-1,pathIndex:Kt,speed:document.querySelector(".js-speed").value||500}),Mt.close("modal-1")})}),De(),k=new Te({antialias:!0,preserveDrawingBuffer:!0}),k.setPixelRatio(window.devicePixelRatio),k.setSize(window.innerWidth,window.innerHeight),k.setAnimationLoop(Qt),k.shadowMap.enabled=!0,k.transparent=!0,k.alpha=!0,k.xr.enabled=!0,Et.appendChild(k.domElement),lt=k.xr.getController(0),lt.addEventListener("selectstart",de),lt.addEventListener("selectend",_e),R.add(lt),ct=k.xr.getController(1),ct.addEventListener("selectstart",de),ct.addEventListener("selectend",_e),R.add(ct);const a=[new x(0,0,0),new x(1e4,0,0)],r=new mt({color:"red",linewidth:3}),l=new ot().setFromPoints(a),c=new it(l,r);R.add(c);const d=[new x(0,0,0),new x(0,1e4,0)],E=new mt({color:"green",linewidth:3}),f=new ot().setFromPoints(d),w=new it(f,E);R.add(w);const g=[new x(0,0,0),new x(0,0,1e4)],U=new mt({color:"blue",linewidth:3}),v=new ot().setFromPoints(g),S=new it(v,U);R.add(S);const h=new Be(100,100);R.add(h);const _=new Ne;St=k.xr.getControllerGrip(0),St.add(_.createControllerModel(St)),R.add(St),At=k.xr.getControllerGrip(1),At.add(_.createControllerModel(At)),R.add(At),dt=new je([...H],Z,k.domElement),dt.rotateSpeed=2,dt.addEventListener("drag",Qt),dt.addEventListener("dragstart",function(){q.enabled=!1}),dt.addEventListener("dragend",function(){q.enabled=!0});const u=new ot().setFromPoints([new x(0,0,0),new x(0,0,-1)]),m=new it(u);m.name="line",m.scale.z=5,lt.add(m.clone()),ct.add(m.clone()),vt=new Ke,window.addEventListener("resize",os),document.addEventListener("click",as);const T=Et.querySelector("canvas");T&&T.addEventListener("dragover",P=>{P.preventDefault()});const y=new Xe,D=document.querySelector("#file");D==null||D.addEventListener("change",P=>{y.load(URL.createObjectURL(P.target.files[0]),F=>{const C=new Ge({color:Math.random()*16777215,specular:1118481,shininess:200}),Y=new zt(F,C);Y.position.x=Math.random()*4-2,Y.position.y=Math.random()*2,Y.position.z=Math.random()*4-2,Y.scale.setScalar(Math.random()+.5),Y.castShadow=!0,Y.receiveShadow=!0,F.center(),X.add(Y),H.push(Y)})});const z=()=>{let P;try{const F="image/jpeg",C="image/octet-stream";P=k.domElement.toDataURL(F),G(P.replace(F,C),"snapshot.jpg")}catch(F){console.log(F);return}},G=(P,F)=>{const C=document.createElement("a");typeof C.download=="string"?(document.body.appendChild(C),C.download=F,C.href=P,C.click(),document.body.removeChild(C)):location.replace(uri)};(st=document.querySelector("#snapshot button"))==null||st.addEventListener("click",z);const N=document.querySelector("#object-view-mode-select");N==null||N.addEventListener("change",P=>{tt=P.target.value});const et=document.querySelector(".js-path-list");if(et){const P=et.querySelectorAll(".path-item");P.forEach((F,C)=>{F.addEventListener("click",()=>{Kt!==C&&(Kt=C,P.forEach(Y=>{Y.classList.remove("selected")}),F.classList.add("selected"))})})}}function os(){Z.aspect=window.innerWidth/window.innerHeight,Z.updateProjectionMatrix(),k.setSize(window.innerWidth,window.innerHeight)}function de(n){const t=n.target,s=Le(t);if(s.length>0){const i=s[0].object;i.material.emissive.b=1,t.attach(i),t.userData.selected=i}t.userData.targetRayMode=n.data.targetRayMode}function _e(n){const t=n.target;if(t.userData.selected!==void 0){const s=t.userData.selected;s.material.emissive.b=0,X.attach(s),t.userData.selected=void 0}}function Le(n){return n.updateMatrixWorld(),vt.setFromXRController(n),vt.intersectObjects(X.children,!1)}function me(n){if(n.userData.targetRayMode==="screen"||n.userData.selected!==void 0)return;const t=n.getObjectByName("line"),s=Le(n);if(s.length>0){const e=s[0],i=e.object;i.material.emissive.r=1,qt.push(i),t.scale.z=e.distance}else t.scale.z=5}function ns(){for(;qt.length;){const n=qt.pop();n.material.emissive.r=0}}function as(n){if(!n.target.closest("canvas"))return;n.preventDefault();const t=dt.getObjects();t.length=0,Gt.x=n.clientX/window.innerWidth*2-1,Gt.y=-(n.clientY/window.innerHeight)*2+1,vt.setFromCamera(Gt,Z);const s=vt.intersectObjects(H,!0);if(s.length>0){const e=s[0].object;X.children.includes(e)===!0?(e.material.emissive.set(0),R.attach(e)):(e.material.emissive.set(11184810),X.attach(e)),q.transformGroup=!0,t.push(X)}X.children.length===0&&(q.transformGroup=!1,t.push(...H)),Qt()}function rs(){xe.forEach(n=>{const t=n.objIndex,s=H[t],e=Wt[n.pathIndex];if(s&&e)if(n.pathIndex>0){const i=e.getPoints(50).length,r=Date.now()/(201-n.speed)%i/i,l=e.getPointAt(r);s.position.copy(l);const c=e.getTangentAt(r).normalize();s.lookAt(l.clone().add(c))}else{let i=ss.getElapsedTime()*(parseFloat(n.speed)/200)%1;Ft.getPointAt(i,Xt),s.position.copy(Xt);const a=Ft.getTangentAt(i).normalize(),r=new x(a.x,a.y,0);s.lookAt(Xt.clone().add(new x().copy(r)))}})}function De(){const n=document.querySelector("#object-list .object-item-container"),t=s=>{console.log("Follow id: ",s);const e=H[s];n==null||n.querySelectorAll(".object-item").forEach(i=>{i.classList.remove("active")}),_t===s?_t=null:(n.querySelector(`.object-item[data-id="${s}"]`).classList.add("active"),_t=s,Ce(e,Z,q))};for(let s=0;s<H.length;s++){let e=Pt==null?void 0:Pt[s];const i=H[s];if(!e){const r=$e(H[s]);Pt.push(r);const l=document.createElement("div");l.classList.add("object-item"),l.dataset.id=s,l.innerHTML=`
        <img src="${r}" alt="object snapshot" />
        <div class="object-info">
        </div>
      `,l.addEventListener("click",()=>t(s)),n.appendChild(l)}const a=n.querySelector(`.object-item[data-id="${s}"] .object-info`);a&&(a.innerHTML=`(${i.position.x.toFixed(2)}, ${i.position.y.toFixed(2)}, ${i.position.z.toFixed(2)})`)}}function Qt(){if(ns(),me(lt),me(ct),rs(),De(),_t!==null){const n=H[_t],t=tt==null?void 0:tt.includes("first");n.visible=!t,tt!=null&&tt.includes("fixed")?Je(n,Z,t):Ce(n,Z,q,t)}for(let n=0;n<H.length;n++)_t!==n&&(H[n].visible=!0);k.render(R,Z)}
