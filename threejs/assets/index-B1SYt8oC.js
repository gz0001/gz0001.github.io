import{T as je,S as Z,C as _,P as ee,O as te,H as ne,D as oe,G as ae,W as se,a as re,V as a,E as Ce,b as xe,c as Le,d as Se,e as Ee,M as k,B as Pe,f as ze,g as Ge,I as De,h as Re,i as $,j as ke,k as C,L as z,l as x,X as Fe,m as Oe,R as He,n as Ie,o as We}from"./STLLoader-CUGKHluW.js";import{C as ie}from"./camera-controls.module-DKxc4fxB.js";ie.install({THREE:je});const Ae=n=>{const e=document.createElement("div");e.style.width="100vw",e.style.height="100vh";const s=new re,t=new Z;t.background=new _("skyblue");const r=new ee(50,window.innerWidth/window.innerHeight,.1,2e3);r.position.set(1,1,1);const m=new te(r,e);m.target.set(0,1.6,0),m.update(),t.add(new ne(12369084,10855845,3));const u=new oe("0xffffff",3);u.position.set(0,6,0),u.castShadow=!0,u.shadow.camera.top=3,u.shadow.camera.bottom=-3,u.shadow.camera.right=3,u.shadow.camera.left=-3,u.shadow.mapSize.set(4096,4096),t.add(u);const y=new ae,M=n.clone();M.position.set(0,0,0),y.add(M),t.add(y);const h=new se({antialias:!0,preserveDrawingBuffer:!0});h.setPixelRatio(window.devicePixelRatio),h.setSize(window.innerWidth,window.innerHeight),h.shadowMap.enabled=!0,h.xr.enabled=!0,e.appendChild(h.domElement);const j=new ie(r,h.domElement);j.fitToBox(y),j.zoomTo(1);const H=s.getDelta();j.update(H),h.render(t,r);const I=h.domElement.toDataURL("image/jpeg");return e.remove(),h.dispose(),m.dispose(),j.dispose(),I};let G,b,c,w,S,E,P,F,O,D;const T=[];let v,g;const f=[],L=[],ce=[[new a(-10,0,10),new a(-5,5,5),new a(5,5,5),new a(5,-5,5),new a(10,0,10),new a(-10,0,10)],[new a(-10,0,-20),new a(50,10,10)]],Be=new re,de=new Ce(0,0,10,5);let Y;const N=new a,le=[],B=new xe;Te();function Te(){var V;G=document.createElement("div"),document.body.appendChild(G),c=new Z,c.background=new _("skyblue"),b=new ee(50,window.innerWidth/window.innerHeight,.1,2e3),b.position.set(10,10,10),v=new te(b,G),v.target.set(0,1.6,0),v.update();const n=new Le(6,6),e=new Se({opacity:.25,blending:Ee,transparent:!1}),s=new k(n,e);s.rotation.x=-Math.PI/2,s.receiveShadow=!0,c.add(s),c.add(new ne(12369084,10855845,3));const t=new oe("0xffffff",3);t.position.set(0,6,0),t.castShadow=!0,t.shadow.camera.top=3,t.shadow.camera.bottom=-3,t.shadow.camera.right=3,t.shadow.camera.left=-3,t.shadow.mapSize.set(4096,4096),c.add(t),g=new ae,c.add(g);const r=[new Pe(.2,.2,.2),new ze(.2,.2,64),new Ge(.2,.2,.2,64),new De(.2,8),new Re(.2,.04,64,32)];for(let d=0;d<3;d++){const i=r[Math.floor(Math.random()*r.length)],l=new $({color:Math.random()*16777215,roughness:.7,metalness:0}),o=new k(i,l);o.position.x=Math.random()*4-2,o.position.y=Math.random()*2,o.position.z=Math.random()*4-2,o.rotation.x=Math.random()*2*Math.PI,o.rotation.y=Math.random()*2*Math.PI,o.rotation.z=Math.random()*2*Math.PI,o.scale.setScalar(Math.random()+.5),o.castShadow=!0,o.receiveShadow=!0,g.add(o),f.push(o)}new a(-10,0,10),new a(-5,5,5),new a(5,5,5),new a(5,-5,5),new a(10,0,10),new a(-10,0,10),ce.map(d=>{const i=new ke(d),l=new C().setFromPoints(i.getPoints(50)),o=new z({color:16777215}),A=new x(l,o);c.add(A),le.push(i)}),Y=new x(new C().setFromPoints(de.getSpacedPoints(100)),new z({color:"yellow"})),c.add(Y);let m=new a;document.querySelectorAll(".nav-item").forEach(d=>{d.addEventListener("dragend",i=>{m.set(i.clientX/window.innerWidth*2-1,-(i.clientY/window.innerHeight)*2+1,.9),m.unproject(b);const l=d.getAttribute("data-type"),o=r[l],A=new $({color:Math.random()*16777215,roughness:.7,metalness:0}),p=new k(o,A);p.position.x=m.x,p.position.y=m.y,p.position.z=m.z,p.rotation.x=Math.random()*2*Math.PI,p.rotation.y=Math.random()*2*Math.PI,p.rotation.z=Math.random()*2*Math.PI,p.scale.setScalar(Math.random()+.5),p.castShadow=!0,p.receiveShadow=!0,g.add(p),f.push(p)})}),me(),w=new se({antialias:!0,preserveDrawingBuffer:!0}),w.setPixelRatio(window.devicePixelRatio),w.setSize(window.innerWidth,window.innerHeight),w.setAnimationLoop(q),w.shadowMap.enabled=!0,w.xr.enabled=!0,G.appendChild(w.domElement),S=w.xr.getController(0),S.addEventListener("selectstart",J),S.addEventListener("selectend",K),c.add(S),E=w.xr.getController(1),E.addEventListener("selectstart",J),E.addEventListener("selectend",K),c.add(E);const u=[new a(0,0,0),new a(1e4,0,0)],y=new z({color:"red",linewidth:3}),M=new C().setFromPoints(u),h=new x(M,y);c.add(h);const j=[new a(0,0,0),new a(0,1e4,0)],H=new z({color:"green",linewidth:3}),I=new C().setFromPoints(j),he=new x(I,H);c.add(he);const ue=[new a(0,0,0),new a(0,0,1e4)],pe=new z({color:"blue",linewidth:3}),ge=new C().setFromPoints(ue),fe=new x(ge,pe);c.add(fe);const X=new Fe;F=w.xr.getControllerGrip(0),F.add(X.createControllerModel(F)),c.add(F),O=w.xr.getControllerGrip(1),O.add(X.createControllerModel(O)),c.add(O),P=new Oe([...f],b,w.domElement),P.rotateSpeed=2,P.addEventListener("drag",q),P.addEventListener("dragstart",function(){v.enabled=!1}),P.addEventListener("dragend",function(){v.enabled=!0});const be=new C().setFromPoints([new a(0,0,0),new a(0,0,-1)]),R=new x(be);R.name="line",R.scale.z=5,S.add(R.clone()),E.add(R.clone()),D=new He,window.addEventListener("resize",qe),document.addEventListener("click",Ue);const U=G.querySelector("canvas");U&&U.addEventListener("dragover",d=>{d.preventDefault()});const ye=new Ie,W=document.querySelector("#file");W==null||W.addEventListener("change",d=>{ye.load(URL.createObjectURL(d.target.files[0]),i=>{const l=new We({color:Math.random()*16777215,specular:1118481,shininess:200}),o=new k(i,l);o.position.x=Math.random()*4-2,o.position.y=Math.random()*2,o.position.z=Math.random()*4-2,o.scale.setScalar(Math.random()+.5),o.castShadow=!0,o.receiveShadow=!0,i.center(),g.add(o),f.push(o)})});const Me=()=>{let d;try{const i="image/jpeg",l="image/octet-stream";d=w.domElement.toDataURL(i),ve(d.replace(i,l),"snapshot.jpg")}catch(i){console.log(i);return}},ve=(d,i)=>{const l=document.createElement("a");typeof l.download=="string"?(document.body.appendChild(l),l.download=i,l.href=d,l.click(),document.body.removeChild(l)):location.replace(uri)};(V=document.querySelector("#snapshot button"))==null||V.addEventListener("click",Me)}function qe(){b.aspect=window.innerWidth/window.innerHeight,b.updateProjectionMatrix(),w.setSize(window.innerWidth,window.innerHeight)}function J(n){const e=n.target,s=we(e);if(s.length>0){const r=s[0].object;r.material.emissive.b=1,e.attach(r),e.userData.selected=r}e.userData.targetRayMode=n.data.targetRayMode}function K(n){const e=n.target;if(e.userData.selected!==void 0){const s=e.userData.selected;s.material.emissive.b=0,g.attach(s),e.userData.selected=void 0}}function we(n){return n.updateMatrixWorld(),D.setFromXRController(n),D.intersectObjects(g.children,!1)}function Q(n){if(n.userData.targetRayMode==="screen"||n.userData.selected!==void 0)return;const e=n.getObjectByName("line"),s=we(n);if(s.length>0){const t=s[0],r=t.object;r.material.emissive.r=1,T.push(r),e.scale.z=t.distance}else e.scale.z=5}function Xe(){for(;T.length;){const n=T.pop();n.material.emissive.r=0}}function Ue(n){if(!n.target.closest("canvas"))return;n.preventDefault();const e=P.getObjects();e.length=0,B.x=n.clientX/window.innerWidth*2-1,B.y=-(n.clientY/window.innerHeight)*2+1,D.setFromCamera(B,b);const s=D.intersectObjects(f,!0);if(s.length>0){const t=s[0].object;g.children.includes(t)===!0?(t.material.emissive.set(0),c.attach(t)):(t.material.emissive.set(11184810),g.attach(t)),v.transformGroup=!0,e.push(g)}g.children.length===0&&(v.transformGroup=!1,e.push(...f)),q()}function Ve(){le.forEach((s,t)=>{const r=f[t],m=ce[t].length+1,y=Date.now()/(t*500+1e3)%m/m,M=s.getPointAt(y);r.position.copy(M);const h=s.getTangentAt(y).normalize();r.lookAt(M.clone().add(h))});let n=Be.getElapsedTime()*.5%1;const e=f[2];de.getPointAt(n,N),e.position.copy(N)}function me(){let n="";for(let e=0;e<f.length;e++){let s=L==null?void 0:L[e];const t=f[e];if(!s){const m=Ae(f[e]);L.push(m)}const r=`
      <div class="object-item">  
        <img src="${L[e]}" alt="object snapshot" />
        <div class="object-info">
         (${t.position.x.toFixed(2)}, ${t.position.y.toFixed(2)}, ${t.position.z.toFixed(2)})
        </div>
      </div>
    `;n+=r}document.querySelector("#object-list .object-item-container").innerHTML=n,console.log({objectSnapshots:L})}function q(){Xe(),Q(S),Q(E),Ve(),me(),w.render(c,b)}
