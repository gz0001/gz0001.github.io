import{T as je,S as Q,C as Z,P as _,O as ee,H as te,D as ne,G as oe,W as ae,a as se,V as a,E as Ce,b as xe,c as Le,d as Se,e as Ee,M as k,B as Pe,f as ze,g as Ge,I as De,h as Re,i as V,j as ke,k as j,L as z,l as C,X as Fe,m as Oe,R as He,n as Ie,o as We}from"./STLLoader-CUGKHluW.js";import{C as re}from"./camera-controls.module-DKxc4fxB.js";re.install({THREE:je});const Ae=n=>{const t=document.createElement("div");t.style.width="100vw",t.style.height="100vh";const s=new se,e=new Q;e.background=new Z("skyblue");const r=new _(50,window.innerWidth/window.innerHeight,.1,2e3);r.position.set(1,1,1);const m=new ee(r,t);m.target.set(0,1.6,0),m.update(),e.add(new te(12369084,10855845,3));const u=new ne("0xffffff",3);u.position.set(0,6,0),u.castShadow=!0,u.shadow.camera.top=3,u.shadow.camera.bottom=-3,u.shadow.camera.right=3,u.shadow.camera.left=-3,u.shadow.mapSize.set(4096,4096),e.add(u);const y=new oe,M=n.clone();M.position.set(0,0,0),y.add(M),e.add(y);const h=new ae({antialias:!0,preserveDrawingBuffer:!0});h.setPixelRatio(window.devicePixelRatio),h.setSize(window.innerWidth,window.innerHeight),h.shadowMap.enabled=!0,h.xr.enabled=!0,t.appendChild(h.domElement);const P=new re(r,h.domElement);P.fitToBox(y),P.zoomTo(1);const H=s.getDelta();return P.update(H),h.render(e,r),h.domElement.toDataURL("image/jpeg")};let G,b,c,w,L,S,E,F,O,D;const B=[];let v,g;const f=[],x=[],ie=[[new a(-10,0,10),new a(-5,5,5),new a(5,5,5),new a(5,-5,5),new a(10,0,10),new a(-10,0,10)],[new a(-10,0,-20),new a(50,10,10)]],Be=new se,ce=new Ce(0,0,10,5);let $;const Y=new a,de=[],A=new xe;Te();function Te(){var U;G=document.createElement("div"),document.body.appendChild(G),c=new Q,c.background=new Z("skyblue"),b=new _(50,window.innerWidth/window.innerHeight,.1,2e3),b.position.set(10,10,10),v=new ee(b,G),v.target.set(0,1.6,0),v.update();const n=new Le(6,6),t=new Se({opacity:.25,blending:Ee,transparent:!1}),s=new k(n,t);s.rotation.x=-Math.PI/2,s.receiveShadow=!0,c.add(s),c.add(new te(12369084,10855845,3));const e=new ne("0xffffff",3);e.position.set(0,6,0),e.castShadow=!0,e.shadow.camera.top=3,e.shadow.camera.bottom=-3,e.shadow.camera.right=3,e.shadow.camera.left=-3,e.shadow.mapSize.set(4096,4096),c.add(e),g=new oe,c.add(g);const r=[new Pe(.2,.2,.2),new ze(.2,.2,64),new Ge(.2,.2,.2,64),new De(.2,8),new Re(.2,.04,64,32)];for(let d=0;d<3;d++){const i=r[Math.floor(Math.random()*r.length)],l=new V({color:Math.random()*16777215,roughness:.7,metalness:0}),o=new k(i,l);o.position.x=Math.random()*4-2,o.position.y=Math.random()*2,o.position.z=Math.random()*4-2,o.rotation.x=Math.random()*2*Math.PI,o.rotation.y=Math.random()*2*Math.PI,o.rotation.z=Math.random()*2*Math.PI,o.scale.setScalar(Math.random()+.5),o.castShadow=!0,o.receiveShadow=!0,g.add(o),f.push(o)}new a(-10,0,10),new a(-5,5,5),new a(5,5,5),new a(5,-5,5),new a(10,0,10),new a(-10,0,10),ie.map(d=>{const i=new ke(d),l=new j().setFromPoints(i.getPoints(50)),o=new z({color:16777215}),W=new C(l,o);c.add(W),de.push(i)}),$=new C(new j().setFromPoints(ce.getSpacedPoints(100)),new z({color:"yellow"})),c.add($);let m=new a;document.querySelectorAll(".nav-item").forEach(d=>{d.addEventListener("dragend",i=>{m.set(i.clientX/window.innerWidth*2-1,-(i.clientY/window.innerHeight)*2+1,.9),m.unproject(b);const l=d.getAttribute("data-type"),o=r[l],W=new V({color:Math.random()*16777215,roughness:.7,metalness:0}),p=new k(o,W);p.position.x=m.x,p.position.y=m.y,p.position.z=m.z,p.rotation.x=Math.random()*2*Math.PI,p.rotation.y=Math.random()*2*Math.PI,p.rotation.z=Math.random()*2*Math.PI,p.scale.setScalar(Math.random()+.5),p.castShadow=!0,p.receiveShadow=!0,g.add(p),f.push(p)})}),we(),w=new ae({antialias:!0,preserveDrawingBuffer:!0}),w.setPixelRatio(window.devicePixelRatio),w.setSize(window.innerWidth,window.innerHeight),w.setAnimationLoop(T),w.shadowMap.enabled=!0,w.xr.enabled=!0,G.appendChild(w.domElement),L=w.xr.getController(0),L.addEventListener("selectstart",N),L.addEventListener("selectend",J),c.add(L),S=w.xr.getController(1),S.addEventListener("selectstart",N),S.addEventListener("selectend",J),c.add(S);const u=[new a(0,0,0),new a(1e4,0,0)],y=new z({color:"red",linewidth:3}),M=new j().setFromPoints(u),h=new C(M,y);c.add(h);const P=[new a(0,0,0),new a(0,1e4,0)],H=new z({color:"green",linewidth:3}),me=new j().setFromPoints(P),he=new C(me,H);c.add(he);const ue=[new a(0,0,0),new a(0,0,1e4)],pe=new z({color:"blue",linewidth:3}),ge=new j().setFromPoints(ue),fe=new C(ge,pe);c.add(fe);const q=new Fe;F=w.xr.getControllerGrip(0),F.add(q.createControllerModel(F)),c.add(F),O=w.xr.getControllerGrip(1),O.add(q.createControllerModel(O)),c.add(O),E=new Oe([...f],b,w.domElement),E.rotateSpeed=2,E.addEventListener("drag",T),E.addEventListener("dragstart",function(){v.enabled=!1}),E.addEventListener("dragend",function(){v.enabled=!0});const be=new j().setFromPoints([new a(0,0,0),new a(0,0,-1)]),R=new C(be);R.name="line",R.scale.z=5,L.add(R.clone()),S.add(R.clone()),D=new He,window.addEventListener("resize",qe),document.addEventListener("click",Ue);const X=G.querySelector("canvas");X&&X.addEventListener("dragover",d=>{d.preventDefault()});const ye=new Ie,I=document.querySelector("#file");I==null||I.addEventListener("change",d=>{ye.load(URL.createObjectURL(d.target.files[0]),i=>{const l=new We({color:Math.random()*16777215,specular:1118481,shininess:200}),o=new k(i,l);o.position.x=Math.random()*4-2,o.position.y=Math.random()*2,o.position.z=Math.random()*4-2,o.scale.setScalar(Math.random()+.5),o.castShadow=!0,o.receiveShadow=!0,i.center(),g.add(o),f.push(o)})});const Me=()=>{let d;try{const i="image/jpeg",l="image/octet-stream";d=w.domElement.toDataURL(i),ve(d.replace(i,l),"snapshot.jpg")}catch(i){console.log(i);return}},ve=(d,i)=>{const l=document.createElement("a");typeof l.download=="string"?(document.body.appendChild(l),l.download=i,l.href=d,l.click(),document.body.removeChild(l)):location.replace(uri)};(U=document.querySelector("#snapshot button"))==null||U.addEventListener("click",Me)}function qe(){b.aspect=window.innerWidth/window.innerHeight,b.updateProjectionMatrix(),w.setSize(window.innerWidth,window.innerHeight)}function N(n){const t=n.target,s=le(t);if(s.length>0){const r=s[0].object;r.material.emissive.b=1,t.attach(r),t.userData.selected=r}t.userData.targetRayMode=n.data.targetRayMode}function J(n){const t=n.target;if(t.userData.selected!==void 0){const s=t.userData.selected;s.material.emissive.b=0,g.attach(s),t.userData.selected=void 0}}function le(n){return n.updateMatrixWorld(),D.setFromXRController(n),D.intersectObjects(g.children,!1)}function K(n){if(n.userData.targetRayMode==="screen"||n.userData.selected!==void 0)return;const t=n.getObjectByName("line"),s=le(n);if(s.length>0){const e=s[0],r=e.object;r.material.emissive.r=1,B.push(r),t.scale.z=e.distance}else t.scale.z=5}function Xe(){for(;B.length;){const n=B.pop();n.material.emissive.r=0}}function Ue(n){if(!n.target.closest("canvas"))return;n.preventDefault();const t=E.getObjects();t.length=0,A.x=n.clientX/window.innerWidth*2-1,A.y=-(n.clientY/window.innerHeight)*2+1,D.setFromCamera(A,b);const s=D.intersectObjects(f,!0);if(s.length>0){const e=s[0].object;g.children.includes(e)===!0?(e.material.emissive.set(0),c.attach(e)):(e.material.emissive.set(11184810),g.attach(e)),v.transformGroup=!0,t.push(g)}g.children.length===0&&(v.transformGroup=!1,t.push(...f)),T()}function Ve(){de.forEach((s,e)=>{const r=f[e],m=ie[e].length+1,y=Date.now()/(e*500+1e3)%m/m,M=s.getPointAt(y);r.position.copy(M);const h=s.getTangentAt(y).normalize();r.lookAt(M.clone().add(h))});let n=Be.getElapsedTime()*.5%1;const t=f[2];ce.getPointAt(n,Y),t.position.copy(Y)}function we(){let n="";for(let t=0;t<f.length;t++){let s=x==null?void 0:x[t];const e=f[t];if(!s){const m=Ae(f[t]);x.push(m)}const r=`
      <div class="object-item">  
        <img src="${x[t]}" alt="object snapshot" />
        <div class="object-info">
         (${e.position.x.toFixed(2)}, ${e.position.y.toFixed(2)}, ${e.position.z.toFixed(2)})
        </div>
      </div>
    `;n+=r}document.querySelector("#object-list .object-item-container").innerHTML=n,console.log({objectSnapshots:x})}function T(){Xe(),K(L),K(S),Ve(),we(),w.render(c,b)}
